{# -*- coding: utf-8 -*- #}
{% extends "form.html" %}
{% load exfiltry %}
{% load exsyntax %}
{% block pythoncode %}
        <script language="python">
        def signal_from_child(self, child, signal):
            if signal=='set_bitmap_list':
                bitmaps = {
                }
                child.set_bitmaps(bitmaps)
        def filter_url(self, target, href):
            return href
</script>
{% endblock %}
{% block all %}
        {% with table_type='datatable' %}
                {{ block.super }}
        {% endwith %}
{% endblock %}
{% block scroll %}{% endblock %}
{% block list_content_actions %}
        {% with object_list.model|args:filter|call:"get_documents_for_reg" as doctypes %}
                {% for item in doctypes %}
                        {% new_row "New document: "|append_str:item.name action="new_row/"|append_str:item.name %}
                {% endfor %}
        {% endwith %}
{% endblock %}
{% block list_row_header %}
        <th>Register</th>
        <th>Target</th>
        <th>Name</th>
        <th>Number</th>
        <th>Description</th>
        <th>Date</th>
        <th>Status</th>
{% endblock %}
{% block list_row %}
        <td>{{object.doc_type_parent.name}}</td>
        <td>{{object.org_chart_parent.name}}</td>
        <td>{{object.name}}</td>
        <td>{{object.number}}</td>
        <td>{{object.description}}</td>
        <td>{{object.date|isoformat}}</td>
        <td>{{object.status}}</td>
{% endblock %}
{% block id_extra %}
        {% row_actions %}
                field_list/docitem_set,Document items,fa fa-lg fa-plus/fa fa-list-ol
        {% endrow_actions %}
        {{ block.super }}
{% endblock %}
{% block list_row_actions %}
        {% if object.status == "" or object.status == 'edit' %}
                {% row_actions %}
                        edit-inline
                        delete
                {% endrow_actions %}
        {% endif %}
        {% with object|args:request|call:"get_visible_statuses" as vs %}
                {% if vs %}
                        {% for row in vs %}
                                {% action "approve_status"|append_str:"/"|append_str:row.name row.description row.icon target='popup_edit' url=table_path|append_str:"{id}/action/approve/" %}
                        {% endfor %}
                {% endif %}
        {% endwith %}
        {% if object|args:request|call:"status_can_be_undo" %}
                {% action "decline_status"|append_str:"/"|append_str:object.status "Discard status: "|append_str:object.status "fa fa-undo" tag_class="+btn-danger" target='popup_edit' url=table_path|append_str:"{id}/action/discard/" %}
        {% endif %}
{% endblock %}
{% block row_edit %}
        {% block dochead_edit %}
                {% form %}
                {% endform %}
        {% endblock %}
        {% if object.id %}
                {% block docitem_list %}
                        {% frame table_path|append_str:object.id|append_str:"/docitem_set/-/form/sublist/?only_content=1" "200px" %}
                {% endblock %}
        {% endif %}
{% endblock %}

