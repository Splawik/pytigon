{# -*- coding: utf-8 -*- #}
{% extends "form.html" %}
{% load exfiltry %}
{% load exsyntax %}
{% block pythoncode %}
        {% if form_list %}
                <script language="python">
            def init_form(self):
                self['tabsort'].grid.default_command = 'code'
            def signal_from_child(self, child, signal):
                if signal=='set_bitmap_list':
                    bitmaps = {
                        "code":"client://mimetypes/text-x-generic-template.png",
                        "template_edit3":"client://mimetypes/x-office-presentation.png",
                        "doc":"client://apps/help-browser.png"
                    }
                    child.set_bitmaps(bitmaps)
</script>
        {% endif %}
{% endblock %}
{% block all %}
        {% with form_width=960 form_height=1200 show_title_bar=0 title="Views" vform=True %}
                {{ block.super }}
        {% endwith %}
{% endblock %}
{% block list_content_header %}
        {% widget class='menu' id='new_view' title="&New view" %}
                {% for pos in object_list|module_obj:"View_CHOICES" %}
                        <li>
                                <a href="{{request.path}}../../../../{{pos.0}}/add">{{pos.1}}</a>
                        </li>
                {% endfor %}
        {% endwidget %}
{% endblock %}
{% block list_row_header %}
        <th>Name</th>
{% endblock %}
{% block list_row %}
        <td>{{object.name}}</td>
{% endblock %}
{% block list_row_actions %}
        {{ block.super }}
        {% if object.ret_type == 'T' %}
                {% row_actions %}
                        field_edit/view_code,Code,code,_top
                        template_edit3,Template
                        field_edit/doc,Doc,doc,_top
                {% endrow_actions %}
          {% else %}
                {% row_actions %}
                        field_edit/view_code,Code,code,_top
                        field_edit/doc,Doc,doc,_top
                {% endrow_actions %}
        {% endif %}
{% endblock %}
{% block row_edit %}
        {{ form.view_type.as_hidden }}
        <strong>
                {{object.get_view_type_display}}
        </strong>
        {% form %}
                "ret_type", "parent", "name", "url_params"
        {% endform %}
        {% if object.view_type == 'u' %}
                {% form %}
                        "param", "url"
                {% endform %}
          {% else %}
                {{form.param.as_hidden}}
                {% form_item url %}
                        <select name="url" id="id_url" class="select form-control">
                                {% if not object.url or object.url == "" %}
                                        <option selected="selected" value="">---------</option>
                                  {% else %}
                                        <option value="">---------</option>
                                {% endif %}
                                {% for model in object.get_models %}
                                        {% if model == object.url %}
                                                <option value="{{model}}" selected="selected">{{model}}</option>
                                          {% else %}
                                                <option value="{{model}}">{{model}}</option>
                                        {% endif %}
                                {% endfor %}
                        </select>
                {% endform_item %}
        {% endif %}
{% endblock %}

