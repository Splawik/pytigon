{# -*- coding: utf-8 -*- #}
%extends "form.html"

%load exfiltry
%load exsyntax

%% pythoncode
    script language=python
        def filter_url(self, target, href):
            if '/run' in href:
                import subprocess
                import threading
                import sys
                def app_process():
                    cmd = wx.GetApp().scr_path+"/pytigon.py"
                    appset = href.split('_')[-1].split('?')[0]
                    arg = " "+appset
                    subprocess.call([sys.executable, cmd, arg], shell=False)
                threading.Thread(target = app_process).start()
                return True
            return href

%% all
    %with edit_vscroll=True table_type='datatable'
        {{ block.super }}
    script===>
        // Code injected by live-server
          var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
          var address = protocol + window.location.host +'/echo/';
          var socket = new WebSocket(address);
        (function() {
          socket.onmessage = function(msg) {
            console.log("I just got reply from server!: " + msg.data);
          };
          console.log('Web Socket enabled.');
          socket.onopen = function(event) {
            console.log("WebSocket is open now.");
            socket.send('Hello world!');
          };          
          
          
        })();
        function onSend(){
            socket.send('e');
        }

%% list_content_actions
    % new_row _("New application set")
    % list_action "prj_import/edit" _("Import")
    % list_action "restart_server" _("Restart server") target="_top" active=False
    % list_action "update" _("Update server from git")


%% list_row_header
    th...Name


%% list_row
    td...{{object.name}}


%% list_row_actions
    % row_actions: ===>
        UP,Open in toolbar,[|wx.ART_GO_TO_PARENT],_top2_toolbar_Aplikacje__Lista_aplikacji,+src='client://actions/go-top.png',,{{app_path}}table/SChAppSet_up/{id}/schapp_set/-/form/list/?childwin=1
        edit
        gen,Build,[|client://categories/applications-multimedia.png]
        |
        field_list/schapp_set,Applications,[|client://apps/preferences-system-windows.png]
        field_edit/user_app_template,Application template,[|client://mimetypes/text-x-script.png],_top
        field_edit/doc,Doc,[|client://apps/help-browser.png],_top2
        field_list/schstatic_set,Static files,[|client://apps/system-file-manager.png],_top
        field_list/schlocale_set,Locale,[|client://apps/preferences-system-network-proxy.png]
        manage,Manage,[|client://categories/preferences-system.png]
        delete
        run,Run,[|client://actions/media-playback-start.png]
        prj_export,Export(Distribute),[|client://actions/document-save-as.png]
        installer,Make installer(Distribute),[|client://apps/internet-web-browser.png]
        field_edit/readme_file,readme.txt(Distribute),[|fa://navicon.png],_top
        field_edit/license_file,license.txt(Distribute),license_txt,_top
        field_edit/install_file,install.ini(Distribute),install_ini,_top
        field_edit/encoded_zip,encoded zip file(Distribute),encoded_zip,_top

%% dialog_type
    .modal-lg

%% row_edit

    %form "^/6":
        .name,title
    %form "^/12":
        .ext_apps,plugins
    %form "^/6":
        .gui_type,gui_elements,login_required,start_page
    %form "^/2":
        .desktop_gui_type,tablet_gui_type,smartfon_gui_type,public,main

    % if standard_web_browser:
        %form "^/12":
            .custom_tags,user_param
    % else:    
        % form_item custom_tags:
            {{form.custom_tags|textfiel_row_col:"4x100"}}
        % form_item user_param:
            {{form.user_param|textfiel_row_col:"4x100"}}
