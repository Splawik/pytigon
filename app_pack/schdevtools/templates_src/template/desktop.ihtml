

%extends 'template/desktop_base.html'|translate:lang


% load exfiltry
% load exsyntax
% load bootstrap4
% load staticfiles

%% js_extrascipts
    {{block.super}}
    {% jscript_link 'vue/vue.js' %}
    
    {% jscript_link 'app/schdevtools/js/test_javascript.js' %}
    {% jscript_link 'app/schdevtools/js/test_python.js' %}
    
    <script src="https://unpkg.com/xterm@3.6.0/dist/xterm.js"></script>
    <script src="https://unpkg.com/xterm@3.6.0/dist/addons/fit/fit.js"></script>

%% extrastyle
    {{block.super}}
    {% css_link 'app/schdevtools/css/style.css' %}
    {% css_link 'app/schdevtools/css/test_icss.css' %}
    
    {% css_link 'app/_schwiki/css/wiki_editor.css' %}
    

%% body_footer
    {{block.super}}
    
    <div style="width: 100%; height: 600px;">
    <div id="terminal"></div>
    </div>
    
    script===>
          
          var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
          var address = protocol + window.location.host +'/schcommander/shell/';
          
          var websocket = new WebSocket(address);
          
          //Terminal.applyAddon(fullscreen)
          Terminal.applyAddon(fit)
          
          const term = new Terminal();
          term.open(document.getElementById('terminal'));
          //term.resize(80,25)
          
          term.setOption('fontFamily', 'monospace');
          term.setOption('fontSize', 14);
          term.setOption('lineHeight', 1.1);
          
          //term.fit()
          //console.log(`size: ${term.cols} columns, ${term.rows} rows`)
          //term.toggleFullScreen(true);
          //term.fit()
          
          term.on('key', (key, ev) => {
            var txt = JSON.stringify({ input: key });
            websocket.send(txt);
          });

          websocket.onmessage = function(evt)  {
            term.write(evt.data);
          }
          
          function fitToscreen(){
            term.fit();
            console.log(term.cols, term.rows)
            var s = JSON.stringify({resize: { cols: term.cols, rows: term.rows}})
            websocket.send(s);            
          }
          
          websocket.onopen = function() {
                fitToscreen();
          };
          
          
          function debounce(func, wait_ms) {
            let timeout
            return function(...args) {
              const context = this
              clearTimeout(timeout)
              timeout = setTimeout(() => func.apply(context, args), wait_ms)
            }
          }
          const wait_ms = 50;
          window.onresize = debounce(fitToscreen, wait_ms)
    

    
    {% component 'app/standard_components/components/summernote.js' %}
    {% component 'app/standard_components/components/plotly.js' %}
    {% component 'app/schdevtools/components/test.js' %}
    {% component 'app/standard_components/components/leaflet.js' %}
    {% component 'app/standard_components/components/d3.js' %}
    {% component 'app/standard_components/components/code_editor.js' %}
    {% component 'app/standard_components/components/handsontable.js' %}
    {% component 'app/standard_components/components/vs_editor.js' %}
    {% component 'app/standard_components/components/pivottable.js' %}
    {% component 'app/standard_components/components/txtarea_editor.js' %}
    {% component 'app/standard_components/components/video-js.js' %}
    
    <link rel="stylesheet" href="https://unpkg.com/xterm@3.6.0/dist/xterm.css" />

%% component_init
    .component_init = [ "summernote", "plotly", "test", "leaflet", "d3", "code_editor", "handsontable", "vs_editor", "pivottable", "txtarea_editor", "video-js",  ] 

%% botstrap_css
    {% css_link 'themes/bootswatch/materia/bootstrap.min.css' %}

%% js_app_init
    .db_struct = [ ["devparam", {"keyPath": "key"}] ];
    .init_db(db_struct);
    .devtools_sync = function(run_after) {
    .    console.log("SYNC!");
    .    run_after("OK");
    .}
    .sync_struct = [ ['devparam', "{{base_path}}schdevtools/devparam/", devtools_sync], ];
    .init_sync(sync_struct);
    {{ block.super }}

%% logo
    span class=logo-lg
        img src={{base_path}}static/favicon.ico,,,style=height:100%;
        span class=txt3d text-white,,,style=font-size:1rem;
            .Pytigon - dev tools
