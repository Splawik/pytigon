app: pytigon

ingredients:
  dist: xenial
  sources: 
    - deb http://archive.ubuntu.com/ubuntu/ xenial main universe
    - deb http://ppa.launchpad.net/jonathonf/python-3.6/ubuntu xenial main
  packages:
    - python3.6
    - python3-distutils
    - curl 
    - git 
    - apt-transport-https 
    - mysql-client 
    - libmysqlclient-dev 
    - zip

  script:
    - virtualenv venv -p $(which python3.6) --always-copy
    - venv/bin/pip install -f https://extras.wxpython.org/wxPython4/extras/linux/gtk2/ubuntu-16.04/ wxPython
    - venv/bin/pip install Pillow mysqlclient cefpython3
    - wget -c https://github.com/Splawik/pytigon/archive/master.zip
    - unzip master.zip
    - venv/bin/pip install -r pytigon-master/requirements.txt 
    
script:
  - cat > pytigon.desktop <<EOF
  - [Desktop Entry]
  - Type=Application
  - Name=Pytigon
  - Icon=pytigon
  - Exec=pytigon
  - Categories=Utility;
  - EOF
  - mkdir opt
  - cp -R ../pytigon-master opt/pytigon
  - cp -Rf ../venv/lib/python3.*/site-packages/* usr/lib/python3/dist-packages/    
  - ( cd opt/pytigon/ ; ../../usr/bin/python3.6 manage.py compile_templates )
  - cp opt/pytigon/pytigon.png usr/share/icons/hicolor/48x48/pytigon.png
  - cp usr/share/icons/hicolor/48x48/pytigon.png .
  - ( cd usr/bin/ ; ln -s ../../opt/pytigon/appimage_pytigon.py pytigon )
  - chmod a+x opt/pytigon/appimage_pytigon.py

