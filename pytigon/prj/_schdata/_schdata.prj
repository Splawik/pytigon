[
    {
        "additional_settings": "",
        "app_main": null,
        "autor_email": null,
        "autor_name": null,
        "autor_www": null,
        "components_initial_state": null,
        "custom_tags": "_schcomponents/components/ptig-wysiwygedit.js\n_schcomponents/components/ptig-codeeditor.js",
        "desktop_gui_type": "tablet_modern",
        "doc": "",
        "encoded_zip": null,
        "ext_apps": "_schtools.schtools",
        "git_repository": "https://git.pytigon.eu/pytigon/_schdata.git",
        "gui_elements": null,
        "gui_type": "modern",
        "icon": "None",
        "icon_code": null,
        "icon_size": "1",
        "install_file": null,
        "jsondata": null,
        "license_file": null,
        "login_required": false,
        "main": false,
        "main_view": true,
        "name": "_schdata",
        "plugins": null,
        "public": true,
        "readme_file": null,
        "smartfon_gui_type": "auto",
        "start_page": "_schdata",
        "tablet_gui_type": "tablet_modern",
        "template_desktop": null,
        "template_schweb": null,
        "template_smartfon": null,
        "template_tablet": null,
        "template_theme": null,
        "title": "Data structures",
        "user_app_template": "",
        "version": "latest"
    },
    [
        [
            {
                "consumer_code": "",
                "doc": "",
                "icon": "None",
                "icon_code": null,
                "icon_size": "1",
                "index": null,
                "jsondata": null,
                "model_code": "import copy\nfrom pytigon_lib.schdjangoext.django_ihtml import ihtml_to_html\nfrom django.template.loader import select_template\nimport datetime\nfrom django.db import transaction\nfrom django.contrib.contenttypes.models import ContentType\nfrom pytigon_lib.schtools.tools import content_to_function\nfrom django.db.models import Q, Sum\nfrom django.apps import apps\n\n\ndef get_element_queryset():\n    return None\n\nGET_ELEMENT_QUERYSET =  OverwritableCallable(get_element_queryset)\n\nclass ElementManager(models.Manager):\n    def get_queryset(self):\n        q = GET_ELEMENT_QUERYSET()\n        if q:\n            return super().get_queryset().filter(q)\n        else:\n            return super().get_queryset()\n",
                "module_title": "Data structures",
                "name": "schelements",
                "perms": true,
                "tasks_code": "",
                "title": "Elements",
                "urls_code": "gen.for_field('DocType', 'dochead_set', 'Documents', prefix=\"doc\", template_name=\"schelements/dochead2.html\")\n",
                "user_param": "",
                "view_code": "from django.urls import resolve\nfrom django.conf import settings\nfrom django.db import transaction\nfrom django_select2.forms import HeavySelect2Widget, ModelSelect2Widget\nfrom django.core.validators import int_list_validator\n\nfrom pytigon_lib.schtools.tools import content_to_function\nfrom pytigon_lib.schdjangoext.fastform import form_from_str\nfrom django.db.models import Q, F\n\ndef year_ago():\n    dt = datetime.date.today()    \n    try:\n        dt = dt.replace(year=dt.year-1)\n    except ValueError:\n        dt = dt.replace(year=dt.year-1, day=dt.day-1)\n    return dt\n\ndef change_status(request, pk, action='accept'):    \n    doc_head = models.DocHead.objects.get(pk=pk)\n    doc_type = doc_head.doc_type_parent\n    doc_reg = doc_type.parent\n    action_name = request.GET.get('x1', '')\n    reg_status_list = models.DocRegStatus.objects.filter(parent=doc_reg, name=action_name)\n    if len(reg_status_list)==1:\n        reg_status = reg_status_list[0]\n    else: \n        reg_status = None\n    form = None\n\n    if reg_status:\n        if action=='accept':\n            form_txt = reg_status.accept_form\n            fun = content_to_function(reg_status.accept_proc, \"request, doc_head, reg_status, doc_type, doc_reg, doc_status, form\", globals_dict = { 'models': models ,})\n        else:\n            form_txt = reg_status.undo_form\n            fun = content_to_function(reg_status.undo_proc, \"request, doc_head, reg_status, doc_type, doc_reg, doc_status, form\", globals_dict = { 'models': models ,})\n\n        params = {\n            'request': request,\n            'doc_head': doc_head,\n            'doc_type': doc_type,\n            'doc_reg': doc_reg,\n        }\n        if form_txt:\n            form_class = form_from_str(form_txt, params)\n        else:\n            form_class = None\n\n        if (not form_class) or request.POST :\n            if form_class:\n                form = form_class(request.GET, request.POST)\n            else:\n                form = None\n\n            if (not form) or form.is_valid():\n                doc_status = models.DocHeadStatus()\n                doc_status.parent = doc_head\n\n                try:\n                    with transaction.atomic(): \n                        errors = fun(request, doc_head, reg_status, doc_type, doc_reg, doc_status, form)\n                except ValueError as err:\n                    errors = err.args\n\n                if not errors:\n                    if action_name and action_name != doc_head.status:\n                        doc_head.status = action_name\n                        doc_head.save()\n\n                    if action != 'accept':\n                        models.DocItem.objects.filter(parent=doc_head, level__gte = reg_status.order).delete()\n\n                    doc_status.date = datetime.datetime.now()\n                    doc_status.operator = request.user.username\n                    doc_status.save()\n\n                    return actions.update_row_ok(request, int(doc_head.id), str(doc_head))\n                else:\n                    return { 'errors': errors, 'form': form, 'doc_head': doc_head, 'doctype': doc_type, 'doc_reg': doc_reg, 'reg_status': reg_status, 'action_name': action_name, }\n        if not form:\n            if form_class:\n                form = form_class()\n            else:\n                form = None\n            return { 'error': False, 'form': form, 'doc_head': doc_head, 'doctype': doc_type, 'doc_reg': doc_reg, 'reg_status': reg_status, \n                'action_name': action_name,\n            }\n    else:\n        return { 'error': \"Status %s doesn't exists\" % action_name }\n"
            },
            [
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_element\", \"Can administer elements\"),\n]\n",
                        "name": "Element",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def init_new(self, request, view, param=None):\n    defaults = { 'type': param }\n    return defaults\n\ndef save(self, *argi, **argv):\n    if not self.code:\n        object_list = Element.objects.filter(type=self.type, code__startswith=self.type).order_by('-id')\n        if len(object_list)>0:\n            x = object_list[0].code.split('-')[-1]\n            try:\n                i = int(x) + 1\n            except:\n                i = 1\n            self.code = self.type+\"-\"+str(i)\n        else:\n            self.code = self.type+\"-1\"\n\n    path = self.code\n    if self.key:\n        key_path = self.key.name\n    else:\n        key_path = \"\"\n\n    tab = self.parents()\n    for pos in tab:\n        path = pos.code + \"/\" + path\n        if pos.key:\n            if key_path:\n                key_path = pos.key.name + '/' + key_path\n            else:\n                key_path = pos.key.name\n\n    self.path = path\n    self.key_path = key_path\n    \n    if len(tab)>0:\n        self.first_ancestor = tab[-1]\n        super().save(*argi, **argv)\n    else:\n        super().save(*argi, **argv)\n        self.first_ancestor = self\n        super().save(*argi, **argv)\n    \n\ndef get_name(self):\n    return self.name\n\ndef _get_parent_elem(element_type):\n    tab = self.parents()\n    for pos in tab:\n        if pos.type==element_type:\n            return pos\n    return None\n    \ndef company(self):\n    return self._get_parent_elem('O-COM')\n\ndef division(self):\n    return self._get_parent_elem('O-DIV')\n\ndef departament(self):\n    return self._get_parent_elem('O-DEP')\n\ndef position(self):\n    return self._get_parent_elem('O-POS')\n\ndef location(self):\n    return self._get_parent_elem('O-LOC')\n\ndef owner_group(self):\n    return self._get_parent_elem('O-GRP')\n\ndef owner_grand_group(self):\n    grp =  self._get_parent_elem('O-GRP')\n    if grp:\n        return grp._get_parent_elem('O-GRP')\n    else:\n        return None\n\ndef item_group(self):\n    return self._get_parent_elem('I-GRP')\n\ndef item_grand_group(self):\n    grp =  self._get_parent_elem('I-GRP')\n    if grp:\n        return grp._get_parent_elem('I-GRP')\n    else:\n        return None\n\ndef related(self):\n    ret = \"\"\n    for obj in (self.grand_parent1, self.grand_parent2, self.grand_parent3, self.grand_parent4):\n        if obj:\n            if ret == \"\":\n                ret = obj.name\n            else:\n                ret = ret + \"; \" + obj.name\n    return ret\n\ndef parents(self):\n    p = []\n    parent = self.parent\n    while(parent):\n        p.append(parent)\n        if parent==parent.parent:\n            break\n        parent = parent.parent\n    return p\n\ndef del_get_children(self, child_type):\n    ret = []\n    object_list = Element.objects.filter(parent=self)\n    for child in object_list:\n        if child.type == child_type:\n            ret.append(child)\n        else:\n            x = child.get_children(child_type)\n            if x:\n                ret.extend(list(x))\n    return ret\n\ndef q_for_children(self, child_type):\n    ret = []\n    ret.append(Q(parent=self))\n    object_list = list(Element.objects.filter(parent=self).exclude(type=child_type))\n    if len(object_list)>0:\n        for child in object_list:\n                x = child.get_children(child_type)\n                if x:\n                    ret.extend(list(x))\n    return ret\n\ndef get_children(self, child_type):\n    qq = self.q_for_children(child_type)\n    return Element.objects.filter(*qq)\n\n@staticmethod\ndef get_children_for_element(parent_code, child_type):\n    object_list = Element.objects.filter(code=parent_code)\n    if len(object_list)>0:\n        return object_list[0].get_children(child_type)\n    return []\n\n@staticmethod\ndef limit_choices(parent_code, child_type):\n    ids = []\n    objects = Element.get_children_for_element(parent_code, child_type)\n    for obj in objects:\n        ids.append(obj.id)\n    return Q(id__in=ids)\n\ndef href_path(self):\n    p = self.parents()\n    n=\"\"\n    for parent in p:\n        href = \"<a target='_refresh_data' href='../../%s/form/tree'>\" % parent.id\n        if parent.code and parent.code!=\"\":\n            n = href + parent.code + \"</a>/\" + n\n        else:\n            n = href + \"?</a>/\" + n\n    return \"<a target='_refresh_data' href='../../0/form/tree'>/</a>\" + n + self.code\n\ndef href_path_list(self):\n    p = self.parents()\n    n=[]\n    for parent in p:\n        href = \"<a target='_refresh_data' href='../../%s/form/tree'>\" % parent.id\n        if parent.code and parent.code!=\"\":\n            n.append(href + parent.code + \"</a>\")\n        else:\n            n.append(href + \"?</a>\")\n    n.append(\"<a target='_refresh_data' href='../../0/form/tree'>/</a>\")\n    return n\n\ndef __str__(self):\n    p = self.parents()\n    if self.code and self.code!=\"\":\n        n = self.code + \":\" + self.name\n    else:\n        n = self.name\n    for parent in p:\n        if parent.code and parent.code!=\"\":\n            n = parent.code + \"/\" + n\n        else:\n            n = \"?/\" + n\n    return n\n\n@staticmethod\ndef gen_url(value):\n    if value:\n        id = int(value)\n    else:\n        id = -1\n    return \"/schsys/treedialog/schelements/Element/%s/\" % id\n    \n\n@staticmethod\ndef add_type(type_code, type_name):\n    global element_type_choice\n    element_type_choice.append((type_code, type_name))\n\ndef get_derived_object(self, param=None):\n    t = None\n    if type(self)==Element:\n        if hasattr(self, \"get_structure\"):\n            s = self.get_structure()\n            if param and 'view' in param and 'add_param' in param['view'].kwargs:\n                t = param['view'].kwargs['add_param']\n                if t=='-':\n                    return self\n                if t in s:\n                    model = apps.get_model(s[t]['app'], s[t]['table'])\n                    return model.objects.get(pk=self.id)\n            else:\n                t = self.type\n                if t in s:\n                    if hasattr(self, s[t]['table'].lower()):\n                        return getattr(self, s[t]['table'].lower())\n                    else:\n                        model = apps.get_model(s[t][\"app\"], s[t][\"table\"])\n                        return model.objects.get(pk=self.id)\n    return self\n\n\ndef template_for_object(self, view, context, doc_type):\n    if self.id and doc_type in ('html', 'json'):\n        if hasattr(self, \"get_structure\"):\n            s = self.get_structure()\n            t = self.type\n            if t in s:\n                names = [ s[t]['app'].lower() + '/' + s[t]['table'].lower()+\".html\", ]\n                return names\n    return None\n\n\n@staticmethod\ndef _get_new_buttons(elem_type=\"ROOT\"):\n    buttons = []\n    \n    if hasattr(Element, \"get_structure\"):\n        s = Element.get_structure()\n        if elem_type in s:\n            if 'next' in s[elem_type]:\n                for item in s[elem_type]['next']:\n                    if item in s:\n                        button = {}\n                        button['type'] = item\n                        if 'title' in s[item]:\n                            button['title'] = s[item]['title']\n                        else:\n                            button['title'] = item\n                        if 'app' in s[item]:\n                            button['app'] = s[item]['app']\n                        else:\n                            button['app'] = \"\"\n                        if 'table' in s[item]:\n                            button['table'] = s[item]['table']\n                        else:\n                            button['table'] = \"\"\n\n                        buttons.append(button)\n    return buttons\n    \n@staticmethod\ndef get_root_new_buttons():\n    return Element._get_new_buttons(\"ROOT\")\n\ndef get_new_buttons(self):\n    if self.type in ('O-GRP', 'I-GRP'):\n        obj = self\n        while obj and obj.type in ('O-GRP', 'I-GRP'):\n            obj = obj.parent\n        if obj:\n            buttons = self._get_new_buttons(obj.type)\n        else:\n            buttons = self._get_new_buttons(\"ROOT\")\n        if self.description and '(' in self.description and ')' in self.description:\n            item = self.description.split('(')[1].split(')')[0]\n            if not ',' in item and not ';' in item:\n                s = Element.get_structure()\n                if item in s:\n                    button = {}\n                    button['type'] = item\n                    if 'title' in s[item]:\n                        button['title'] = s[item]['title']\n                    else:\n                        button['title'] = item\n                    if 'app' in s[item]:\n                        button['app'] = s[item]['app']\n                    else:\n                        button['app'] = \"\"\n                    if 'table' in s[item]:\n                        button['table'] = s[item]['table']\n                    else:\n                        button['table'] = \"\"\n                    if not button in buttons:\n                        buttons.append(button)\n            ret = []\n            for button in buttons:\n                if button['type'] in self.description:\n                    ret.append(button)\n            return ret\n        else:\n            return buttons\n        \n    else:\n        return self._get_new_buttons(self.type)\n\nobjects = ElementManager()\n",
                        "url_params": null,
                        "verbose_name": "Element",
                        "verbose_name_plural": "Elements"
                    },
                    [
                        {
                            "blank": true,
                            "choices": "",
                            "db_index": false,
                            "default": "",
                            "description": "Parent",
                            "editable": true,
                            "help_text": "",
                            "name": "parent",
                            "null": true,
                            "param": "",
                            "rel_to": "'self'",
                            "type": "PtigTreeForeignKey",
                            "unique": false,
                            "url_params": ""
                        },
                        {
                            "blank": false,
                            "choices": "element_type_choice",
                            "db_index": false,
                            "default": null,
                            "description": "Element type",
                            "editable": true,
                            "help_text": null,
                            "name": "type",
                            "null": false,
                            "param": "max_length=8",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Code",
                            "editable": true,
                            "help_text": null,
                            "name": "code",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Path",
                            "editable": true,
                            "help_text": null,
                            "name": "path",
                            "null": true,
                            "param": "max_length=1024",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": "",
                            "db_index": false,
                            "default": "",
                            "description": "Name",
                            "editable": true,
                            "help_text": "",
                            "name": "name",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": "",
                            "type": "CharField",
                            "unique": false,
                            "url_params": ""
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Description",
                            "editable": true,
                            "help_text": null,
                            "name": "description",
                            "null": true,
                            "param": "max_length=256",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": "1",
                            "description": "Quantity",
                            "editable": true,
                            "help_text": null,
                            "name": "quantity",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "IntegerField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Key",
                            "editable": true,
                            "help_text": null,
                            "name": "key",
                            "null": false,
                            "param": "key =  models.ForeignKey('auth.Group', on_delete=models.CASCADE, null=True, blank=True,)",
                            "rel_to": null,
                            "type": "UserField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Key path",
                            "editable": false,
                            "help_text": null,
                            "name": "key_path",
                            "null": true,
                            "param": "max_length=256",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "First ancestor",
                            "editable": true,
                            "help_text": null,
                            "name": "first_ancestor",
                            "null": true,
                            "param": "related_name='first_ancestors'",
                            "rel_to": "'self'",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Grand parent 1",
                            "editable": true,
                            "help_text": null,
                            "name": "grand_parent1",
                            "null": true,
                            "param": "related_name='grandparent1'",
                            "rel_to": "'self'",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Grand parent 2",
                            "editable": true,
                            "help_text": null,
                            "name": "grand_parent2",
                            "null": true,
                            "param": "related_name='grandparent2'",
                            "rel_to": "'self'",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Grand parent 3",
                            "editable": true,
                            "help_text": null,
                            "name": "grand_parent3",
                            "null": true,
                            "param": "related_name='grandparent3'",
                            "rel_to": "'self'",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Grand parent 4",
                            "editable": true,
                            "help_text": null,
                            "name": "grand_parent4",
                            "null": true,
                            "param": "related_name='grandparent4'",
                            "rel_to": "'self'",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": "True",
                            "description": "Can have children",
                            "editable": false,
                            "help_text": null,
                            "name": "can_have_children",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "BooleanField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_docreg\", \"Can administer document registers\"),\n]\n",
                        "name": "DocReg",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.name\n\ndef save(self, *args, **kwargs):\n    self.update_time = datetime.datetime.now()\n    super().save(*args, **kwargs)\n\ndef get_parent(self):\n    if '/' in self.name:\n        x = self.name.rsplit('/',1)\n        objs = DocReg.objects.filter(name=x[0])\n        if len(objs)==1:\n            return objs[0]\n    return None\n\ndef get_last_subname(self):\n    if '/' in self.name:\n        return self.name.rsplit('/',1)[1]\n    else:\n        return self.name\n\n",
                        "url_params": null,
                        "verbose_name": "Document register",
                        "verbose_name_plural": "Document registers"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Application",
                            "editable": true,
                            "help_text": null,
                            "name": "app",
                            "null": false,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Name",
                            "editable": true,
                            "help_text": null,
                            "name": "name",
                            "null": false,
                            "param": "max_length=32",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Group",
                            "editable": true,
                            "help_text": null,
                            "name": "group",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Description",
                            "editable": true,
                            "help_text": null,
                            "name": "description",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Head form",
                            "editable": false,
                            "help_text": null,
                            "name": "head_form",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Head template",
                            "editable": false,
                            "help_text": null,
                            "name": "head_template",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Item form",
                            "editable": false,
                            "help_text": null,
                            "name": "item_form",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Item template",
                            "editable": false,
                            "help_text": null,
                            "name": "item_template",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Save head function",
                            "editable": false,
                            "help_text": null,
                            "name": "save_head_fun",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Save item function",
                            "editable": false,
                            "help_text": null,
                            "name": "save_item_fun",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Access function",
                            "editable": false,
                            "help_text": null,
                            "name": "access_fun",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Time of the last update",
                            "editable": true,
                            "help_text": null,
                            "name": "update_time",
                            "null": false,
                            "param": "auto_now_add=True",
                            "rel_to": null,
                            "type": "DateTimeField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_doctype\", \"Can administer document types\"),\n]\n",
                        "name": "DocType",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.name",
                        "url_params": null,
                        "verbose_name": "Type of document",
                        "verbose_name_plural": "Types of documents"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent",
                            "editable": true,
                            "help_text": null,
                            "name": "parent",
                            "null": false,
                            "param": null,
                            "rel_to": "DocReg",
                            "type": "PtigHiddenForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Name",
                            "editable": true,
                            "help_text": null,
                            "name": "name",
                            "null": false,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Description",
                            "editable": true,
                            "help_text": null,
                            "name": "description",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Correction",
                            "editable": true,
                            "help_text": null,
                            "name": "correction",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "NullBooleanField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Head form",
                            "editable": false,
                            "help_text": null,
                            "name": "head_form",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Head template",
                            "editable": false,
                            "help_text": null,
                            "name": "head_template",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Item form",
                            "editable": false,
                            "help_text": null,
                            "name": "item_form",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Item template",
                            "editable": false,
                            "help_text": null,
                            "name": "item_template",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Save head function",
                            "editable": false,
                            "help_text": null,
                            "name": "save_head_fun",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Save item function",
                            "editable": false,
                            "help_text": null,
                            "name": "save_item_fun",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": "doctype_status",
                            "db_index": true,
                            "default": null,
                            "description": "Status of document type",
                            "editable": true,
                            "help_text": null,
                            "name": "doctype_status",
                            "null": true,
                            "param": "max_length=1",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Time of the last update",
                            "editable": true,
                            "help_text": null,
                            "name": "update_time",
                            "null": false,
                            "param": "auto_now_add=True",
                            "rel_to": null,
                            "type": "DateTimeField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": "JSONModel",
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_dochead\", \"Can administer document headers\"),\n]\n",
                        "name": "DocHead",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.doc_type_parent.name + \":\" + self.number\n\n@classmethod\ndef get_documents_for_reg(cls, value):\n    reg = DocReg.objects.filter(name = value.replace('_', '/'))\n    ret = []\n    if len(reg) == 1:\n        docs = DocType.objects.filter(parent=reg[0])\n        for doc in docs:\n            ret.append(doc)\n    return ret\n\n@classmethod\ndef filter(cls, value, view=None, request=None):\n    if value and value.startswith(\"_code_\"):\n        code = value.replace(\"_code_\", \"\")\n        return cls.objects.filter(parent_element__code=code)\n    elif value and value.startswith(\"_pk_\"):\n        i = value.replace(\"_pk_\", \"\")\n        x = cls.objects.filter(parent_element__pk=int(i))\n        return x\n    elif value:\n        rej = value.replace(\"_\", \"/\")\n        return cls.objects.filter(doc_type_parent__parent__name=rej)\n    else:\n        return cls.objects.all()\n\ndef init_new(self, request, view, add_param=None):\n    if add_param:\n        docs = DocType.objects.filter(name = add_param)\n        if len(docs)==1: \n            self.doc_type_parent = docs[0]\n            self.date = datetime.datetime.now()\n            self.status = 'draft'\n            self.operator = request.user.username\n            \n    return None\n    \n@staticmethod\ndef template_for_list(view, model, context, doc_type):\n    if doc_type in ('html', 'json') and 'filter' in context:\n        tmp = DocReg.objects.filter(name=context['filter'].replace('_','/'))\n        reg = tmp.first()\n        if len(tmp)==1:\n            names = []\n            if reg and reg.head_template:\n                names.append(\"db/DocReg-%d-head_template.html\" % reg.id)\n            \n            x = tmp[0]\n            while x:\n                names.append((x.app+\"/\"+x.name.replace('/','_')+\"_dochead_list.html\").lower())\n                x = x.get_parent()\n            \n            if 'target' in view.kwargs and 'calendar' in view.kwargs['target']:\n                names2 = []\n                for name in names:\n                    names2.append(name.replace(\".html\", \"_\"+view.kwargs['target']+\".html\"))\n                names = names2\n            \n            #template = select_template(names)\n            names.append(view.template_name)\n            return names\n            #if template:\n            #    return template\n            \n    return None\n    \n    \ndef template_for_object(self, view, context, doc_type):\n    if doc_type in ('html', 'json'):\n        try:\n            if 'add_param' in view.kwargs:\n                objects = DocType.objects.filter(name=view.kwargs['add_param'])\n                doc_type = objects[0]\n                reg = doc_type.parent\n                obj = None\n            else: \n                obj = DocHead.objects.get(pk=self.id)            \n                reg = obj.doc_type_parent.parent\n            names = []\n\n            if reg.head_template:\n                names.append(\"db/DocReg-%d-head_template.html\" % reg.id)\n\n            names.append('%s/%s'% (self._meta.app_label, self._meta.model.__name__))\n            if obj:\n                names.append((reg.app+\"/\"+obj.doc_type_parent.name+\"_dochead_edit.html\").lower())        \n            else:\n                names.append((reg.app+\"/\"+doc_type.name+\"_dochead_edit.html\").lower())        \n            names.append((reg.app+\"/\"+reg.name.replace('/', '_') + \"_dochead_edit.html\").lower())\n            x = reg.get_parent()\n            while x:\n                names.append((x.app+\"/\"+x.name.replace('/', '_') + \"_dochead_edit.html\").lower())\n                x = x.get_parent()\n            names.append(context['view'].template_name)\n            return names\n            #template = select_template(names)\n            #if template:\n            #    return template\n        except:\n            return None\n    return None\n    \n\ndef get_form_source(self):\n    if self.id:\n        obj = DocHead.objects.get(pk=self.id)            \n        if obj.doc_type_parent.head_form:\n           return obj.doc_type_parent.head_form \n           \n        x = obj.doc_type_parent.parent\n        while x:\n            if x.head_form:\n                return x.head_form\n            x = x.get_parent()\n    \n    return None\n\n\ndef save(self, *args, **kwargs):        \n    if self.id:\n        obj = DocHead.objects.get(pk=self.id)\n        save_fun_src = None\n        if obj.doc_type_parent.save_head_fun:\n            save_fun_src = obj.doc_type_parent.save_head_fun\n        else:\n            x = obj.doc_type_parent.parent\n            while x:\n                if x.save_head_fun:\n                    save_fun_src = x.save_head_fun\n                    break\n                x = x.get_parent()\n        if save_fun_src:\n            content_to_function(save_fun_src, \"object\")(self)\n\n    if not self.pk:\n        self.date_c = datetime.datetime.now()\n        \n        y = \"%04d\" % datetime.date.today().year\n        t = self.doc_type_parent.name\n        objects = DocHead.objects.filter(doc_type_parent=self.doc_type_parent, number__startswith=t+\"/\"+y).order_by('-number')\n        if len(objects)>0:\n            tmp = objects[0].number\n            \n            try:\n                max_num = int(tmp.split('/')[-1])+1\n            except:\n                max_num = 1\n        else:\n            max_num = 1\n        self.number = \"%s/%s/%06d\" % (t, y, max_num)\n    \n    super().save(*args, **kwargs)\n\ndef get_visible_statuses(self, request=None):\n    if self.id:\n        obj = self            \n        reg = obj.doc_type_parent.parent\n        parent_reg = reg\n        if hasattr(reg, \"cached_statuses\"):\n            statuses_to_cache = reg.cached_statuses\n        else:\n            statuses_to_cache = []\n            while reg:\n                statuses = reg.docregstatus_set.all().order_by(\"order\")\n                if len(statuses) > 0:\n                    statuses_to_cache += list(statuses)                        \n                reg = reg.get_parent()\n            setattr(parent_reg, \"cached_statuses\", statuses_to_cache)\n        ret = []\n        for status in statuses_to_cache:\n            if status.can_set_proc:\n                data = content_to_function(\n                    status.can_set_proc, \"request, doc_head\"\n                )(request, self)\n                if data:\n                    ret.append(status)\n            else:\n                ret.append(status)\n        return ret\n    return []\n\ndef status_can_be_undo(self, request=None):\n    if self.id:\n        obj = DocHead.objects.get(pk=self.id)\n        reg = obj.doc_type_parent.parent\n        statuses = reg.docregstatus_set.filter(name=obj.status)\n        if len(statuses)==1:\n            status = statuses[0]\n            if status.can_undo_proc:\n                data = content_to_function(status.can_undo_proc, \"request, doc_head\")(request, self)\n                if data:\n                    return True\n                else:\n                    return False\n        if obj.status == \"\" or obj.status == \"edit\":\n            return False\n        else:\n            return True\n    \n    return False        \n\ndef get_reg_status(self):\n    reg = self.doc_type_parent.parent\n    if hasattr(reg, \"cached_statuses\"):\n        statuses = reg.cached_statuses\n        for status in statuses:\n            if status.name == self.status:\n                return status\n    else:\n        statuses = reg.docregstatus_set.filter(name=self.status)\n        if len(statuses) > 0:\n            return statuses[0]\n    return None\n\ndef get_undo_target(self):\n    reg = self.doc_type_parent.parent\n    statuses = reg.docregstatus_set.filter(name=self.status)\n    if len(statuses)>0:\n        status = statuses[0]\n        return status.get_undo_target()\n    return \"refresh_frame\"\n    \n    \ndef get_derived_object(self, param=None):\n    t = None\n    if type(self)==DocHead:\n        if param and 'view' in param and 'add_param' in param['view'].kwargs:\n            t = param['view'].kwargs['add_param']\n            if t=='-':\n                return self\n            object_list = DocType.objects.filter(name=t)\n            if len(object_list):\n                t = object_list[0].parent.name\n            return ContentType.objects.get(model=t.lower()+\"dochead\").model_class()()\n        else:            \n            t = self.doc_type_parent.parent.name\n            name = t.lower()+\"dochead\"\n            if hasattr(self, name):\n                return getattr(self, name)\n    return self\n\n@classmethod\ndef table_action(cls, list_view, request, data):\n    return standard_table_action(cls, list_view, request, data, ['copy', 'paste', 'delete'])\n    \n@staticmethod\ndef filter_by_permissions(view, queryset_or_obj, request):\n    q = None\n    doc_regs = None\n\n    if hasattr(request, \"user\")  and request.user.is_superuser:\n        return queryset_or_obj\n\n    if hasattr(request, \"user\") and hasattr(request.user, \"profile\"):\n        profile = request.user.profile\n        if profile.doc_regs:\n            doc_regs = list([ item.strip() for item in profile.doc_regs.replace(',',';').split(\";\") if item.strip() ])\n    else:\n        profile = None\n    \n    def append_reg_filter(reg):\n        nonlocal q, profile\n        q2 = Q(doc_type_parent__parent__name = reg.name)\n        if reg.access_fun:\n            exec(reg.access_fun)\n            if 'q_for_list' in locals():\n                q2 = locals()[\"q_for_list\"](request, request.user, profile)\n        if q2:\n            if q:\n                q = q | q2\n            else:\n                q = q2\n            \n    if queryset_or_obj != None:\n        if 'filter' in view.kwargs and not view.kwargs['filter'].startswith('_'):\n            reg_name = view.kwargs['filter'].replace('_','/')\n            if doc_regs:\n                if not reg_name in doc_regs:\n                    return queryset_or_obj.filter(pk=0)\n            reg = DocReg.objects.get(name=reg_name)\n            append_reg_filter(reg)\n        else:\n            regs = DocReg.objects.all()\n            for reg in regs:\n                if not doc_regs or ( doc_regs and reg in doc_regs): \n                    append_reg_filter(reg)\n        if q:\n            return queryset_or_obj.filter(q)\n        else:\n            return queryset_or_obj\n    else:\n        return queryset_or_obj\n    \ndef _check_perm(self, user, perm):\n    # perm: add, change, delete, view\n    reg = self.doc_type_parent.parent\n    if reg.access_fun:\n        exec(reg.access_fun)\n        if 'check_user_perm' in locals():\n            return locals()[\"check_user_perm\"](self, user, perm, self.doc_type_parent.name)\n        else:\n            return True\n\ndef can_change(self, user):\n    return self._check_perm(user, \"change\")\n    \ndef can_delete(self, user):\n    return self._check_perm(user, \"delete\")\n\ndef can_view(self, user):\n    return self._check_perm(user, \"view\")\n\n\n@staticmethod\ndef can_add(doc_type_name, user):\n    doc_type = DocType.objects.get(name=doc_type_name)\n    reg = doc_type.parent\n    if reg.access_fun:\n        exec(reg.access_fun)\n        if \"check_user_perm\" in locals():\n            check = locals()[\"check_user_perm\"](None, user, \"add\", doc_type_name)\n            return check\n        else:\n            return True\n",
                        "url_params": null,
                        "verbose_name": "Document header",
                        "verbose_name_plural": "Document headers"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parents",
                            "editable": false,
                            "help_text": null,
                            "name": "parents",
                            "null": false,
                            "param": null,
                            "rel_to": "'self'",
                            "type": "ManyToManyField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Document type parent",
                            "editable": false,
                            "help_text": null,
                            "name": "doc_type_parent",
                            "null": false,
                            "param": null,
                            "rel_to": "DocType",
                            "type": "PtigHiddenForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent element",
                            "editable": false,
                            "help_text": null,
                            "name": "parent_element",
                            "null": true,
                            "param": null,
                            "rel_to": "Element",
                            "type": "PtigHiddenForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Document number",
                            "editable": true,
                            "help_text": null,
                            "name": "number",
                            "null": true,
                            "param": "max_length=32",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": "datetime.datetime.now",
                            "description": "Creation date",
                            "editable": false,
                            "help_text": null,
                            "name": "date_c",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "DateTimeField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": "datetime.date.today",
                            "description": "Date",
                            "editable": true,
                            "help_text": null,
                            "name": "date",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "DateField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Description",
                            "editable": true,
                            "help_text": null,
                            "name": "description",
                            "null": true,
                            "param": "max_length=128",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Comments",
                            "editable": true,
                            "help_text": null,
                            "name": "comments",
                            "null": true,
                            "param": "max_length=256",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Status",
                            "editable": false,
                            "help_text": null,
                            "name": "status",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Operator",
                            "editable": false,
                            "help_text": null,
                            "name": "operator",
                            "null": true,
                            "param": "max_length=32",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parameter 1",
                            "editable": true,
                            "help_text": null,
                            "name": "param1",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parameter 2",
                            "editable": true,
                            "help_text": null,
                            "name": "param2",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parameter 3",
                            "editable": true,
                            "help_text": null,
                            "name": "param3",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": "JSONModel",
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_docitem\", \"Can administer document items\"),\n]\n",
                        "name": "DocItem",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "@staticmethod\ndef template_for_list(view, model, context, doc_type):\n    if doc_type in ('html', 'json'):\n        if 'parent_pk' in context['view'].kwargs:\n            parent_pk = int(context['view'].kwargs['parent_pk'])\n            dochead = DocHead.objects.get(pk=parent_pk)\n            reg = dochead.doc_type_parent.parent            \n            names = []\n            if reg.item_template:\n                names.append(\"db/DocReg-%d-item_template.html\" % reg.id)\n            names.append((reg.app+\"/\"+dochead.doc_type_parent.name+\"_docitem_list.html\").lower())\n            names.append((reg.app+\"/\"+reg.name.replace('/', '_') + \"_docitem_list.html\").lower())\n            \n            x = reg.get_parent()\n            while x:\n                names.append(x.app+\"/\"+x.name.replace('/', '_') + \"_docitem_list.html\")\n                x = x.get_parent()\n            names.append(view.template_name)\n            return names\n            \n    return None\n\n\ndef template_for_object(self, view, context, doc_type):\n    if doc_type in ('html', 'json'):\n        try:\n            obj = DocItem.objects.get(pk=self.id)\n            dochead = obj.parent\n        except:\n            dochead = context['view'].object.parent\n\n        reg = dochead.doc_type_parent.parent            \n        names = []\n        if reg.item_template:\n            names.append(\"db/DocReg-%d-item_template.html\" % reg.id)\n        names.append((reg.app+\"/\"+dochead.doc_type_parent.parent.name+\"_docitem_edit.html\").lower())\n        names.append((reg.app+\"/\"+reg.name.replace('/', '_') + \"_docitem_edit.html\").lower())\n        x = reg.get_parent()\n        while x:\n            names.append(x.app+\"/\"+x.name.replace('/', '_') + \"_docitem_edit.html\")\n            x = x.get_parent()\n            \n        names.append(context['view'].template_name.replace(reg.app+'/', 'schelements/'))\n        return names\n    return None\n    \n\ndef get_form_source(self):\n    obj = self\n    if obj.parent.doc_type_parent.item_form:\n       return obj.parent.doc_type_parent.item_form \n       \n    x = obj.parent.doc_type_parent.parent\n    while x:\n        if x.item_form:\n            return x.item_form\n        x = x.get_parent()\n    \n    return None\n\ndef init_new(self, request, view, param=None):\n    if 'parent_pk' in view.kwargs:\n        parent_pk = view.kwargs['parent_pk']\n        parent = DocHead.objects.get(pk=parent_pk)\n        items = DocItem.objects.filter(parent=parent).order_by('-order')\n        if len(items)>0:\n            max_nr = int(items[0].order)+1\n        else:\n            max_nr = 1\n        \n        if request.POST:\n            return { 'parent': str(parent.id), 'order': max_nr, 'date_c': datetime.datetime.now(), 'level': 0 }\n        \n    return None\n\n\ndef save(self, *args, **kwargs):\n    if self.id:\n        obj = DocItem.objects.get(pk=self.id).parent\n        save_fun_src = None\n        if obj.doc_type_parent.save_head_fun:\n            save_fun_src = obj.doc_type_parent.save_item_fun\n        else:\n            x = obj.doc_type_parent.parent\n            while x:\n                if x.save_head_fun:\n                    save_fun_src = x.save_item_fun\n                    break\n                x = x.get_parent()\n        if save_fun_src:\n            exec(save_fun_src)\n        \n    super().save(*args, **kwargs)\n    \n   \ndef get_derived_object(self, param=None):\n    t = None\n    if type(self)==DocItem:\n        if param and 'view' in param and 'add_param' in param['view'].kwargs:\n            t = param['view'].kwargs['add_param']\n            if t=='-':\n                return self\n            return ContentType.objects.get(model=t.lower()+\"docitem\").model_class()()\n        else:\n            t = self.parent.doc_type_parent.parent.name\n            name = t.lower()+\"docitem\"\n            if hasattr(self, name):\n                return getattr(self, name)\n            else:\n                obj2 = copy.copy(self)\n                obj2.__class__ =  ContentType.objects.get(model=name).model_class()\n                return obj2\n    return self\n\ndef get_period(self):\n    return \"%04d-%02d\" % (self.parent.date.year, self.parent.date.month)\n\ndef new_account_operation(self, target, account_name, description, sign, amount, element, classifier1value=None, classifier2value=None, classifier3value=None, subcode=None, payment=None, save=True):\n    if subcode == '*':\n        account = Account.objects.get(name=account_name)\n        object_list = AccountState.get_account_state(target, account, element, classifier1valu, classifier2value, classifier3value, \"*\", None)\n        subcode_sum = object_list.values('subcode').annotate(csum=Sum('credit'), dsum=sum('debit')).order_by('subcode')\n        a = amount\n        ret = []\n        for s in subcode_sum:\n            subcode2 = s['subcode']\n            c = s['credit']\n            d = s['debit']\n            b = d - s\n            if b>a:\n                a2 = a\n                a = 0\n            else:\n                a2 = b\n                a -= b\n            x = self.new_account_operation(target, account_name, description, sign, a2, element, classifier1value, classifier2value, classifier3value, subcode2, payment, save)\n            ret.append(x)\n            if a == 0:\n                return ret\n    else:\n        account = Account.objects.get(name=account_name)\n        period = self.get_period()\n        object_list = AccountState.objects.filter(\n            parent=account, \n            element=element, \n            target=target, \n            classifier1value = classifier1value, \n            classifier2value = classifier2value, \n            classifier3value = classifier3value,\n            period = period\n        )\n        if object_list.count() > 0:\n            object = object_list[0]\n        else:\n            object = AccountState()\n            object.parent = account\n            object.element = element\n            object.target = target\n            object.classifier1value = classifier1value\n            object.classifier2value = classifier2value\n            object.classifier3value = classifier3value\n            object.period = period\n            object.debit = 0\n            object.credit = 0\n            object.agregate = False\n            object.save()\n        account_operation = AccountOperation()\n        account_operation.parent = self\n        account_operation.description = description\n        account_operation.payment = payment\n        account_operation.account_state = object\n        account_operation.sign = sign\n        account_operation.amount = amount\n        account_operation.enabled = False\n        if save:\n            account_operation.save()\n        return [account_operation,]\n\n",
                        "url_params": null,
                        "verbose_name": "Document item",
                        "verbose_name_plural": "Document items"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent",
                            "editable": false,
                            "help_text": null,
                            "name": "parent",
                            "null": false,
                            "param": null,
                            "rel_to": "DocHead",
                            "type": "PtigHiddenForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent item",
                            "editable": false,
                            "help_text": null,
                            "name": "parent_item",
                            "null": true,
                            "param": null,
                            "rel_to": "'self'",
                            "type": "PtigHiddenForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Owner",
                            "editable": true,
                            "help_text": null,
                            "name": "owner",
                            "null": true,
                            "param": "related_name=\"owners\"",
                            "rel_to": "Element",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": "1",
                            "description": "Order",
                            "editable": false,
                            "help_text": null,
                            "name": "order",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "IntegerField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Item",
                            "editable": true,
                            "help_text": null,
                            "name": "item",
                            "null": true,
                            "param": null,
                            "rel_to": "Element",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": "",
                            "db_index": false,
                            "default": "",
                            "description": "Amount",
                            "editable": true,
                            "help_text": "",
                            "name": "amount",
                            "null": true,
                            "param": "max_digits=16, decimal_places=2",
                            "rel_to": "",
                            "type": "DecimalField",
                            "unique": false,
                            "url_params": ""
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Amount",
                            "editable": true,
                            "help_text": null,
                            "name": "alt_amount",
                            "null": true,
                            "param": "max_digits=16, decimal_places=2",
                            "rel_to": null,
                            "type": "DecimalField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Alternate unit",
                            "editable": true,
                            "help_text": null,
                            "name": "alt_unit",
                            "null": true,
                            "param": "max_length=32",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": "",
                            "db_index": false,
                            "default": "",
                            "description": "Description",
                            "editable": true,
                            "help_text": "",
                            "name": "description",
                            "null": true,
                            "param": "max_length=255",
                            "rel_to": "",
                            "type": "CharField",
                            "unique": false,
                            "url_params": ""
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": "0",
                            "description": "Level",
                            "editable": false,
                            "help_text": null,
                            "name": "level",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "IntegerField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": "True",
                            "description": "Active item",
                            "editable": true,
                            "help_text": null,
                            "name": "active",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "BooleanField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parameter 1",
                            "editable": false,
                            "help_text": null,
                            "name": "param1",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parameter 2",
                            "editable": false,
                            "help_text": null,
                            "name": "param2",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parameter 3",
                            "editable": false,
                            "help_text": null,
                            "name": "param3",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_docregstatus\", \"Can administer document register statuses\"),\n]\n",
                        "name": "DocRegStatus",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.name\n\ndef get_editor_header(self, field_name):\n    if field_name == \"can_set_proc\":\n        return \"def can_set_proc(request, doc_head):\"\n    elif field_name == \"can_undo_proc\":\n        return \"def can_undo_proc(request, doc_head):\"\n    elif field_name == \"accept_proc\":\n        return \"def accept_proc(request, doc_head, reg_status, doc_type, doc_reg, form):\"\n    elif field_name == \"undo_proc\":\n        return \"def undo_proc(request, doc_head, reg_status, doc_type, doc_reg, form):\"\n        \ndef get_accept_target(self):\n    if self.accept_form:\n        return \"popup_edit\"\n    else:\n        return \"refresh_frame\"\n\ndef get_undo_target(self):\n    if self.undo_form:\n        return \"popup_edit\"\n    else:\n        return \"refresh_frame\"\n",
                        "url_params": null,
                        "verbose_name": "Document status",
                        "verbose_name_plural": "Document status"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent",
                            "editable": true,
                            "help_text": null,
                            "name": "parent",
                            "null": false,
                            "param": null,
                            "rel_to": "DocReg",
                            "type": "PtigHiddenForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Order",
                            "editable": true,
                            "help_text": null,
                            "name": "order",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "IntegerField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Name",
                            "editable": true,
                            "help_text": null,
                            "name": "name",
                            "null": false,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Description",
                            "editable": true,
                            "help_text": null,
                            "name": "description",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Icon",
                            "editable": true,
                            "help_text": null,
                            "name": "icon",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Accept status procedure",
                            "editable": false,
                            "help_text": null,
                            "name": "accept_proc",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Undo status procedure",
                            "editable": false,
                            "help_text": null,
                            "name": "undo_proc",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Check if status can be set",
                            "editable": false,
                            "help_text": null,
                            "name": "can_set_proc",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Check if status can be removed",
                            "editable": false,
                            "help_text": null,
                            "name": "can_undo_proc",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Form for accept",
                            "editable": false,
                            "help_text": null,
                            "name": "accept_form",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Form for undo",
                            "editable": false,
                            "help_text": null,
                            "name": "undo_form",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": "JSONModel",
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_docheadstatus\", \"Can administer document header statuses\"),\n]\n",
                        "name": "DocHeadStatus",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.name",
                        "url_params": null,
                        "verbose_name": "Document head status",
                        "verbose_name_plural": "Documents head status"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent",
                            "editable": true,
                            "help_text": null,
                            "name": "parent",
                            "null": false,
                            "param": null,
                            "rel_to": "DocHead",
                            "type": "PtigHiddenForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Date",
                            "editable": true,
                            "help_text": null,
                            "name": "date",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "DateTimeField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Name",
                            "editable": true,
                            "help_text": null,
                            "name": "name",
                            "null": false,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Description",
                            "editable": false,
                            "help_text": null,
                            "name": "description",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Operator",
                            "editable": true,
                            "help_text": null,
                            "name": "operator",
                            "null": true,
                            "param": "max_length=32",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_account\", \"Can administer accounts\"),\n]\n",
                        "name": "Account",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def save(self, *args, **kwargs):\n    if self.parent:\n        self.parent.type1='S'\n        self.parent.save()\n        self.type2 = self.parent.type2\n    self.type1 = 'A'\n    super().save(*args, **kwargs)\n\ndef __str__(self):\n    x = self\n    ret = self.name\n    while(x.parent):\n        x = x.parent\n        ret = x.name + \"/\" + ret\n    ret+=\": \"\n    ret+=self.description\n    return ret\n        \n",
                        "url_params": null,
                        "verbose_name": "Account",
                        "verbose_name_plural": "Account"
                    },
                    [
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent",
                            "editable": true,
                            "help_text": null,
                            "name": "parent",
                            "null": true,
                            "param": null,
                            "rel_to": "'self'",
                            "type": "PtigTreeForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": "account_type_choice_1",
                            "db_index": false,
                            "default": null,
                            "description": "Type 1",
                            "editable": false,
                            "help_text": null,
                            "name": "type1",
                            "null": true,
                            "param": "max_length=1",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": "account_type_choice_2",
                            "db_index": true,
                            "default": null,
                            "description": "Type 2",
                            "editable": true,
                            "help_text": null,
                            "name": "type2",
                            "null": true,
                            "param": "max_length=1",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Name",
                            "editable": true,
                            "help_text": null,
                            "name": "name",
                            "null": false,
                            "param": "max_length=32",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Description",
                            "editable": true,
                            "help_text": null,
                            "name": "description",
                            "null": false,
                            "param": "max_length=256",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Correctness rule",
                            "editable": true,
                            "help_text": null,
                            "name": "correctness_rule",
                            "null": true,
                            "param": "max_length=256",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Root classifier 1",
                            "editable": true,
                            "help_text": null,
                            "name": "root_classifier1",
                            "null": true,
                            "param": "related_name='baseaccount_rc1_set'",
                            "rel_to": "Element",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Root classifier 2",
                            "editable": true,
                            "help_text": null,
                            "name": "root_classifier2",
                            "null": true,
                            "param": "related_name='baseaccount_rc2_set'",
                            "rel_to": "Element",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Root classifier 3",
                            "editable": true,
                            "help_text": null,
                            "name": "root_classifier3",
                            "null": true,
                            "param": "related_name='baseaccount_rc3_set'",
                            "rel_to": "Element",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": "True",
                            "description": "Enabled",
                            "editable": true,
                            "help_text": null,
                            "name": "enabled",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "NullBooleanField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_accountstatus\", \"Can administer account statuses\"),\n]\n",
                        "name": "AccountState",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    s = self.target.name + \"/\" + self.parent.name\n    if self.classifier1value:\n        s+= \"/\"+classifier1value\n    if self.classifier2value:\n        s+= \"/\"+classifier2value\n    if self.classifier3value:\n        s+= \"/\"+classifier3value\n    if self.subcode:\n        s+=self.subcode\n    s+=\"(\"+self.element.name+\")\"\n    return s\n\n\n@staticmethod    \ndef get_account_state(target=None, account=None, element=None, classifier1value=None, classifier2value=None, classifier3value=None, subcode=None, period=None, q=None):\n    object_list = AccountState.objects.all()\n    if target!=None:\n        if isinstance(target, int):\n            object_list = object_list.filter(target__id=target)\n        elif isinstance(target, Element):\n            object_list = object_list.filter(target=target)\n        elif isinstance(target, str):\n            object_list = object_list.filter(target__code = target)\n        else:\n            return None\n    else:\n        object_list = object_list.filter(target__isnull = True)\n\n    if account!=None:\n        if isinstance(target, int):\n            object_list = object_list.filter(parent__id=account)\n        elif isinstance(target, Account):\n            object_list = object_list.filter(parent=account)\n        elif isinstance(target, str):\n            object_list = object_list.filter(parent__name = account)\n        else:\n            return None\n    \n    if elementt!=None:\n        if isinstance(element, int):\n            object_list = object_list.filter(element__id=element)\n        elif isinstance(element, Element):\n            object_list = object_list.filter(element=element)\n        elif isinstance(target, str):\n            object_list = object_list.filter(element__code = element)\n        else:\n            return None\n    else:\n        object_list = object_list.filter(element__isnull = True)\n\n    if classifier1value!=None:\n        if isinstance(classifier1value, int):\n            object_list = object_list.filter(classifier1value__id=classifier1value)\n        elif isinstance(classifier, Element):\n            object_list = object_list.filter(classifier1value=classifier1value)\n        elif isinstance(classifier, str):\n            object_list = object_list.filter(classifier1value__code = classifier1value)\n        else:\n            return None\n    else:\n        object_list = object_list.filter(classifier1value__isnull = True)\n\n    if classifier2value!=None:\n        if isinstance(classifier2value, int):\n            object_list = object_list.filter(classifier2value__id=classifier2value)\n        elif isinstance(classifier, Element):\n            object_list = object_list.filter(classifier2value=classifier2value)\n        elif isinstance(classifier, str):\n            object_list = object_list.filter(classifier2value__code = classifier2value)\n        else:\n            return None\n    else:\n        object_list = object_list.filter(classifier2value__isnull = True)\n\n    if classifier3value!=None:\n        if isinstance(classifier3value, int):\n            object_list = object_list.filter(classifier3value__id=classifier3value)\n        elif isinstance(classifier, Element):\n            object_list = object_list.filter(classifier3value=classifier3value)\n        elif isinstance(classifier, str):\n            object_list = object_list.filter(classifier3value__code = classifier3value)\n        else:\n            return None\n    else:\n        object_list = object_list.filter(classifier3value__isnull = True)\n\n    if subcode:\n        object_list = object_list.filter(subcode=subcode)\n    else:\n        object_list = object_list.filter(Q(subcode__isnull = True) | Q(subcode__exact = \"\"))\n\n    if period:\n        object_list = object_list.filter(period=period)\n    else:\n        object_list = object_list.filter(Q(period__isnull = True) | Q(period__exact = \"\"))\n\n    if q:\n        object_list = object_list.filter(q)\n\n    return object_list\n\n    \n@staticmethod    \ndef get_balance(target=None, account=None, element=None, classifier1value=None, classifier2value=None, classifier3value=None, subcode=None, period=None, q=None):\n    ret = AccountState.get_account_state(target, account, element, classifier1value, classifier2value, classifier3value, subcode, period, q)\n    result = ret.aggregate(Sum('credit'), Sum('debit'))\n    result['balance__sum'] = result['debit__sum'] - result['credit__sum']\n    return result\n\n\ndef save(self, *args, **kwargs):\n    if self.parent.correctness_rule:\n        x = self.parent.correctness_rule.split(\":\")\n        if len(x)>1:\n            expression = x[0]\n            error_txt = x[1]\n        else:\n            expression = x[0]\n            error_txt = \"The validation rule is not ensured: \" + self.parent.correctness_rule\n            \n        s = expression.replace(\"DEBIT\", str(self.debit)).replace(\"CREDIT\", str(self.credit))\n        if self.period:\n            s = s.replace(\"PERIOD\", self.period)\n        ret = eval(s)\n        if not ret:\n            raise ValueError(error_txt)\n    if self.debit == self.credit:\n        self.zero_balance = True\n    else:\n        self.zero_balance = False\n    super().save(*args, **kwargs)\n",
                        "url_params": null,
                        "verbose_name": "State of account",
                        "verbose_name_plural": "States of account"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent",
                            "editable": true,
                            "help_text": null,
                            "name": "parent",
                            "null": false,
                            "param": null,
                            "rel_to": "Account",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Target",
                            "editable": true,
                            "help_text": null,
                            "name": "target",
                            "null": true,
                            "param": "related_name='state_targets'",
                            "rel_to": "Element",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Classifier 1 value",
                            "editable": true,
                            "help_text": null,
                            "name": "classifier1value",
                            "null": true,
                            "param": "related_name='account_c1_set'",
                            "rel_to": "Element",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Classifier 2 value",
                            "editable": true,
                            "help_text": null,
                            "name": "classifier2value",
                            "null": true,
                            "param": "related_name='account_c2_set'",
                            "rel_to": "Element",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Classifier 3 value",
                            "editable": true,
                            "help_text": null,
                            "name": "classifier3value",
                            "null": true,
                            "param": "related_name='account_c3_set'",
                            "rel_to": "Element",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Period",
                            "editable": true,
                            "help_text": null,
                            "name": "period",
                            "null": true,
                            "param": "max_length=10",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Subcode",
                            "editable": true,
                            "help_text": null,
                            "name": "subcode",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Element",
                            "editable": true,
                            "help_text": null,
                            "name": "element",
                            "null": false,
                            "param": null,
                            "rel_to": "Element",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Debit",
                            "editable": true,
                            "help_text": null,
                            "name": "debit",
                            "null": false,
                            "param": "max_digits=16, decimal_places=2",
                            "rel_to": null,
                            "type": "DecimalField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Credit",
                            "editable": true,
                            "help_text": null,
                            "name": "credit",
                            "null": false,
                            "param": "max_digits=16, decimal_places=2",
                            "rel_to": null,
                            "type": "DecimalField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": "True",
                            "description": null,
                            "editable": true,
                            "help_text": null,
                            "name": "zero_balance",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "BooleanField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": "False",
                            "description": "Aggregate",
                            "editable": true,
                            "help_text": null,
                            "name": "aggregate",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "NullBooleanField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": "datetime.datetime.now",
                            "description": "Creation date",
                            "editable": true,
                            "help_text": null,
                            "name": "date_c",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "DateTimeField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_accountoperation\", \"Can administer account operations\"),\n]\n",
                        "name": "AccountOperation",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.description\n\ndef get_or_create_account_state(self, target, account, element, classifier1, classifier2, classifier3, subcode, period):\n    objs = AccountState.objects.filter(parent=account, element=element, subcode=subcode, period=period)\n    if target:\n        objs = objs.filter(target=target)\n    else:\n        objs = objs.filter(target__isnull=True)\n\n    if classifier1:\n        objs = objs.filter(classifier1value=classifier1)\n    else:\n        objs = objs.filter(classifier1value__isnull=True)\n\n    if classifier2:\n        objs = objs.filter(classifier2value=classifier2)\n    else:\n        objs = objs.filter(classifier2value__isnull=True)\n\n    if classifier3:\n        objs = objs.filter(classifier3value=classifier3)\n    else:\n        objs = objs.filter(classifier3value__isnull=True)\n    \n    \n    if subcode:\n        objs = objs.filter(subcode=subcode)\n    else:\n        objs = objs.filter(Q(subcode__isnull = True) | Q(subcode__exact = \"\"))\n\n    if period:\n        objs = objs.filter(period=period)\n    else:\n        objs = objs.filter(Q(period__isnull = True) | Q(period__exact = \"\"))\n    \n    if objs.count() > 0:\n        return objs[0]\n    else:\n        obj = AccountState()\n        obj.parent = account\n        obj.target = target\n        obj.classifier1value = classifier1\n        obj.classifier2value = classifier2\n        obj.classifier3value = classifier3\n        obj.period = period\n        obj.subcode = subcode\n        obj.element = element\n        obj.aggregate=True\n        obj.debit = 0\n        obj.credit = 0\n        obj.save()\n        return obj\n\n\ndef _update_account_state(self, account, state, debit, credit, with_subcode):\n    targets = (state.target, None) if state.target else (None, )\n    classifier1values = ( state.classifier1value, None) if state.classifier1value else (None,)\n    classifier2values = ( state.classifier2value, None) if state.classifier2value else (None,)\n    classifier3values = ( state.classifier3value, None) if state.classifier3value else (None,)\n    periods = (state.period, None) if state.period else (None, )\n    subcodes = (state.subcode, None) if state.subcode and with_subcode else (None, )\n        \n    for target in targets:\n        for classifier1value in classifier1values:\n            for classifier2value in classifier2values:\n                for classifier3value in classifier3values:\n                    for period in periods:\n                        for subcode in subcodes:\n                            state = self.get_or_create_account_state(target, account, state.element, classifier1value, classifier2value, classifier3value, subcode, period)\n                            state.debit += debit\n                            state.credit += credit\n                            state.save()\n\n\ndef update_accounts_state(self, debit, credit):\n    state = self.account_state\n    account = state.parent\n    self._update_account_state(account, state, debit, credit, True)\n    account = account.parent\n    while account:\n        self._update_account_state(account, state, debit, credit, False)\n        account = account.parent\n\ndef confirm(self):\n    ret = False\n    self.refresh_from_db()\n    if not self.enabled:\n        self.enabled = True\n        if self.sign > 0:\n            self.update_accounts_state(0, self.amount)\n        else:\n            self.update_accounts_state(self.amount, 0)\n        self.save()\n        ret = True\n    return ret\n\ndef atomic_confirm(self):\n    ret = False\n    with transaction.atomic():                \n        ret = self.confirm()\n    return ret\n\ndef cancel_confirmation(self):\n    ret = False\n    self.refresh_from_db()\n    if self.enabled:\n        self.enabled = False\n        if self.sign > 0:\n            self.update_accounts_state(0, -1 * self.amount)\n        else:\n            self.update_accounts_state(-1 * self.amount, 0)\n        self.save()\n        ret = True\n    return ret\n\ndef atomic_cancel_confirmation(self):\n    ret = False\n    with transaction.atomic():                \n        ret = self.cancel_confirmation()\n    return ret\n",
                        "url_params": null,
                        "verbose_name": "Account operation",
                        "verbose_name_plural": "Account operations"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent",
                            "editable": true,
                            "help_text": null,
                            "name": "parent",
                            "null": false,
                            "param": null,
                            "rel_to": "DocItem",
                            "type": "PtigHiddenForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": "datetime.date.today",
                            "description": "Date",
                            "editable": true,
                            "help_text": null,
                            "name": "date",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "DateField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": "datetime.datetime.now",
                            "description": "Creation date",
                            "editable": false,
                            "help_text": null,
                            "name": "date_c",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "DateTimeField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": "",
                            "db_index": false,
                            "default": "",
                            "description": "Description",
                            "editable": true,
                            "help_text": "",
                            "name": "description",
                            "null": false,
                            "param": "max_length=255",
                            "rel_to": "",
                            "type": "CharField",
                            "unique": false,
                            "url_params": ""
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Name of payment",
                            "editable": true,
                            "help_text": null,
                            "name": "payment",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Account state",
                            "editable": true,
                            "help_text": null,
                            "name": "account_state",
                            "null": true,
                            "param": "related_name='accountoper_set', search_fields=['parent__name__icontains',]",
                            "rel_to": "AccountState",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Sign - debit or credit",
                            "editable": true,
                            "help_text": null,
                            "name": "sign",
                            "null": false,
                            "param": null,
                            "rel_to": null,
                            "type": "IntegerField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": "",
                            "db_index": false,
                            "default": "",
                            "description": "Amount",
                            "editable": true,
                            "help_text": "",
                            "name": "amount",
                            "null": false,
                            "param": "max_digits=16, decimal_places=2",
                            "rel_to": "",
                            "type": "DecimalField",
                            "unique": false,
                            "url_params": ""
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": "False",
                            "description": "Enabled",
                            "editable": false,
                            "help_text": null,
                            "name": "enabled",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "NullBooleanField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": false,
                        "metaclass_code": "abstract = True",
                        "name": "BaseObject",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def to_str(self, obj):\n    if self.to_str_fun:\n        tmp = \"def _to_str(self):\\n\" + \"\\n\".join([ \"    \" + pos for pos in self.to_str_fun.split('\\n')])\n        exec(tmp)\n        return locals()['_to_str'](obj)\n    else:\n        if obj.title:\n            return obj.title + \" [\"+self.name+\"]\"\n        else:\n            return str(obj) + \" [\"+self.name+\"]\"\n\ndef get_action_template(self):\n    if self.action_template:\n        return ihtml_to_html(None, self.action_template)\n    else:\n        return None",
                        "url_params": null,
                        "verbose_name": "Base object",
                        "verbose_name_plural": "Base objects"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Application",
                            "editable": true,
                            "help_text": null,
                            "name": "app",
                            "null": false,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Name",
                            "editable": true,
                            "help_text": null,
                            "name": "name",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Description",
                            "editable": true,
                            "help_text": null,
                            "name": "description",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Declaration",
                            "editable": false,
                            "help_text": null,
                            "name": "declaration",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Template source",
                            "editable": false,
                            "help_text": null,
                            "name": "template_src",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Template",
                            "editable": false,
                            "help_text": null,
                            "name": "template",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Convert fields to html",
                            "editable": false,
                            "help_text": null,
                            "name": "to_html_rec",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Save function",
                            "editable": false,
                            "help_text": null,
                            "name": "save_fun",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Load function",
                            "editable": false,
                            "help_text": null,
                            "name": "load_fun",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Object to str function",
                            "editable": false,
                            "help_text": null,
                            "name": "to_str_fun",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Action template",
                            "editable": false,
                            "help_text": null,
                            "name": "action_template",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ]
            ],
            [
                [
                    {
                        "name": "account_type_choice_2",
                        "verbose_name": "Account type 2"
                    },
                    [
                        {
                            "name": "B",
                            "value": "Balance"
                        },
                        {
                            "name": "O",
                            "value": "Off-balance"
                        },
                        {
                            "name": "N",
                            "value": "Non-financial"
                        },
                        {
                            "name": "V",
                            "value": "Inventory"
                        },
                        {
                            "name": "I",
                            "value": "Inventory income"
                        },
                        {
                            "name": "D",
                            "value": "Disposal"
                        }
                    ]
                ],
                [
                    {
                        "name": "account_type_choice_1",
                        "verbose_name": "Account type 1"
                    },
                    [
                        {
                            "name": "S",
                            "value": "Synthetic"
                        },
                        {
                            "name": "A",
                            "value": "Analytical"
                        }
                    ]
                ],
                [
                    {
                        "name": "element_type_choice",
                        "verbose_name": "Element type choice"
                    },
                    [
                        {
                            "name": "O-GRP",
                            "value": "Owner/Group"
                        },
                        {
                            "name": "O-COM",
                            "value": "Owner/Company"
                        },
                        {
                            "name": "O-DIV",
                            "value": "Owner/Division"
                        },
                        {
                            "name": "O-DEP",
                            "value": "Owner/Department"
                        },
                        {
                            "name": "O-POS",
                            "value": "Owner/Position"
                        },
                        {
                            "name": "O-EMP",
                            "value": "Owner/Employee"
                        },
                        {
                            "name": "O-LOC",
                            "value": "Owner/Location"
                        },
                        {
                            "name": "O-PER",
                            "value": "Owner/Person"
                        },
                        {
                            "name": "O-CUS",
                            "value": "Owner/Customer"
                        },
                        {
                            "name": "O-SUP",
                            "value": "Owner/Supplier"
                        },
                        {
                            "name": "O-DEV",
                            "value": "Owner/Device"
                        },
                        {
                            "name": "O-OTH",
                            "value": "Owner/Other"
                        },
                        {
                            "name": "O-ALI",
                            "value": "Owner/Alias"
                        },
                        {
                            "name": "I-GRP",
                            "value": "Item/Group"
                        },
                        {
                            "name": "I-SRV",
                            "value": "Item/Service"
                        },
                        {
                            "name": "I-INT",
                            "value": "Item/Intellectual value"
                        },
                        {
                            "name": "I-CUR",
                            "value": "Item/Currency"
                        },
                        {
                            "name": "I-MAT",
                            "value": "Item/Material"
                        },
                        {
                            "name": "I-RAW",
                            "value": "Item/Raw material"
                        },
                        {
                            "name": "I-PRD",
                            "value": "Item/Product"
                        },
                        {
                            "name": "I-IPR",
                            "value": "Item/Intermediate product"
                        },
                        {
                            "name": "I-MER",
                            "value": "Item/Merchandise"
                        },
                        {
                            "name": "I-DEV",
                            "value": "Item/Device"
                        },
                        {
                            "name": "I-PMA",
                            "value": "Item/Production machine"
                        },
                        {
                            "name": "I-VEH",
                            "value": "Item/Vehicle"
                        },
                        {
                            "name": "I-OTH",
                            "value": "Item/Other"
                        },
                        {
                            "name": "I-ALI",
                            "value": "Item/Alias"
                        },
                        {
                            "name": "C-SYS",
                            "value": "Config/System"
                        },
                        {
                            "name": "C-UNT",
                            "value": "Config/Unit of measure"
                        },
                        {
                            "name": "C-DIC",
                            "value": "Config/Dictionary"
                        },
                        {
                            "name": "C-OTH",
                            "value": "Config/Other"
                        },
                        {
                            "name": "C-ALI",
                            "value": "Config/Alias"
                        },
                        {
                            "name": "C-FLD",
                            "value": "Config/Folder"
                        }
                    ]
                ],
                [
                    {
                        "name": "doctype_status",
                        "verbose_name": "Status of document head"
                    },
                    [
                        {
                            "name": "0",
                            "value": "Disabled"
                        },
                        {
                            "name": "1",
                            "value": "Activ"
                        }
                    ]
                ]
            ],
            [
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "view_doc_heads",
                    "param": "filter, target, vtype",
                    "ret_type": "U",
                    "url": "table/DocHead/(?P<filter>[\\w=_,;-]*)/(?P<target>[\\w_-]*)/[_]?(?P<vtype>)docheadlist/",
                    "url_params": "{}",
                    "view_code": "regs = models.DocReg.objects.filter(name = filter.replace('_','/'))\nif regs.count()>0:\n    new_url = make_href(\"/schelements/table/DocHead/%s/%s/%slist/\" % (filter, target, vtype))\n    view, args, kwargs = resolve(new_url)\n    kwargs['request'] = request\n        \n    #def init(view_obj):\n    #    view_obj.template_name = \"abc\"    \n    #kwargs['init'] = init\n    \n    return view(*args, **kwargs)\nelse:\n    return HttpResponse(\"Error - %s document register doesn't exists\" % filter)\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "view_doc_items",
                    "param": "parent_id",
                    "ret_type": "U",
                    "url": "table/DocItem/(?P<parent_id>\\d+)/docitemlist/",
                    "url_params": "{}",
                    "view_code": "items = models.DocItem.objects.filter(parent=parent_id)\nif items.count()>0:\n    new_url = make_href(\"/schelements/table/DocHead/%s/%s/%slist\" % (filter, target, vtype))\n    view, args, kwargs = resolve(new_url)\n    kwargs['request'] = request\n    return view(*args, **kwargs)\nelse:\n    return HttpResponse(\"Error - %s document register doesn't exists\" % filter)\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "edit_head",
                    "param": "id",
                    "ret_type": "U",
                    "url": "table/DocHead/(?P<id>\\d+)/edit_head/",
                    "url_params": "{}",
                    "view_code": "return HttpResponse(\"Error\")\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "edit_item",
                    "param": "id",
                    "ret_type": "U",
                    "url": "table/DocItem/(?P<id>\\d+)/edit_item/",
                    "url_params": "{}",
                    "view_code": "return HttpResponse(\"Error\")\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "approve",
                    "param": "pk",
                    "ret_type": "T",
                    "url": "DocHead",
                    "url_params": null,
                    "view_code": "return change_status(request, pk, action='accept')    \n",
                    "view_type": "r"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "discard",
                    "param": "pk",
                    "ret_type": "T",
                    "url": "DocHead",
                    "url_params": null,
                    "view_code": "return change_status(request, pk, action='undo')    \n",
                    "view_type": "r"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "view_elements",
                    "param": "code",
                    "ret_type": "U",
                    "url": "view_elements/<slug:code>/",
                    "url_params": "{}",
                    "view_code": "#if settings.URL_ROOT_FOLDER and len(settings.URL_ROOT_FOLDER) > 0:\n#    url_base = '/' + settings.URL_ROOT_FOLDER + '/'\n#else:\n#    url_base = '/'\n\nid = 0\n\nif code:\n    objs = models.Element.objects.filter(code=code)\n    if len(objs)>0:\n        id = objs[0].pk\n        \nhref2 = make_href('/schelements/table/Element/%d/%d/form/treelist/?only_content' % (id,id), request.get_full_path())\nreturn HttpResponseRedirect(href2)\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "view_elements_as_tree",
                    "param": "code,filter,template",
                    "ret_type": "U",
                    "url": "view_elements_as_tree/<slug:code>/<slug:filter>/<slug:template>/",
                    "url_params": "{}",
                    "view_code": "#if settings.URL_ROOT_FOLDER and len(settings.URL_ROOT_FOLDER) > 0:\n#    url_base = '/' + settings.URL_ROOT_FOLDER + '/'\n#else:\n#    url_base = '/'\n\nid = 0\n\nif code and code != '-':\n    objs = models.Element.objects.filter(code=code)\n    if len(objs)>0:\n        id = objs[0].pk\n\nif template:\n    target = 'form__'+template\nelse:\n    target = 'form'\n        \nhref2 = make_href('/schelements/table/Element/%d/%s/%s/tree/?only_content' % (id,filter,target), request.get_full_path())\nreturn HttpResponseRedirect(href2)\n",
                    "view_type": "u"
                }
            ],
            [
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "Element",
                    "tags_mount": null,
                    "template_code": "% extends \"forms/tree.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                    \"name1\": \"image_path1\",\n                    \"name2\": \"image_path2\",\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% on_dialog_load {:}\n    function show_hide(typ):\n        if (typ=='S'):\n            $('label[for|=\"id_grand_parent\"]').show()\n            $('label[for|=\"id_description\"]').show()\n            $('select[name^=\"grand_parent\"]').show()\n            $('input[name=\"description\"]').show()\n            $('#id_key').show()\n        else:\n            $('label[for|=\"id_grand_parent\"]').hide()\n            $('label[for|=\"id_description\"]').hide()\n            $('select[name^=\"grand_parent\"]').hide()\n            $('input[name=\"description\"]').hide()\n            $('#id_key').hide()\n\n    $('#id_type').change(\n        function():\n            var typ\n            typ = $(this)[0].options[$(this)[0].selectedIndex].value\n            show_hide(typ)\n            return false\n\n    var id_type=$('#id_type')[0].options[$('#id_Typ')[0].selectedIndex].value\n    show_hide(id_type)\n    if(id_type!=\"\"):\n        $('label[for|=\"id_type\"]').hide()\n        $('select[name=\"type\"]').hide()\n\n\n%% all\n    %with table_type='datatable' title=\"Elements\":\n        {{ block.super }}\n\n%% list_content_actions_new_row\n    % if not readonly:\n        % if parent_pk > 0:\n            % with buttons=parent.get_new_buttons:\n                % if buttons:\n                    % for button in buttons:\n                        % new_row \"new \"|append_str:button.title url=base_path|append_str:button.app|append_str:\"/table/\"|append_str:button.table|append_str:'/%d/this/'|format:parent_pk|append_str:button.type|append_str:\"/add/\"\n                % else:\n                    % if parent_pk:\n                        % new_row \"_(New element)\" url=table_path|append_str:'%d/this/-/add/'|format:parent_pk\n        % else\n            % with buttons=model.get_root_new_buttons:\n                % if buttons:\n                    % for button in buttons:\n                        % new_row \"new \"|append_str:button.title url=base_path|append_str:button.app|append_str:\"/table/\"|append_str:button.table|append_str:'/0/this/'|append_str:button.type|append_str:\"/add/\"\n                % else:\n                    % new_row \"_(New element)\" url=table_path|append_str:'0/this/-/add/'\n\n%% list_row_header\n    th..._(Type)\n    th..._(Code)\n    th..._(Name)\n\n%% list_row\n    td\n        img src={{ STATIC_URL }}icons/struct/elm_{{object.type}}.png\n    td...{{object.code}}\n    td...{{object.name}}\n\n\n%% row_edit\n    % if form_add\n        % form:\n            .parent:!, type\n    % else\n        % form:\n            .parent,type:!\n    % form: \n        \"code\", \"name\", \"key\"   \n    %if not object.type or object.type == 'S'\n        % form:\n            \"grand_parent1\", \"grand_parent2\", \"grand_parent3\"\n    % form:\n        \"description\"\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "BaseAccount",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with form_width=<<dx>> form_height=<<dy>>\n        {{ block.super }}\n\n%% scroll\n\n%% form_header\n    p\n        % new_row \"<<new_row_title>>\"\n        % action_table \"<<action>>\" \"<<action_title>>\"\n\n%% table_header\n  tr\n    td...ID\n    td...<<col_name>>\n    td...Action\n\n%% table_content\n    tr\n        td:::a href={{object.id}}/info?width=<<info_dy>>&height=<<info_dx>>,,,title=<<info_title>>,,,class=thickbox...{{object.id}}\n        td...{{object.<<object_name>>}}\n        td\n            % list_field \"<<child_name>>_set\" \"<<child_id>>\" \"<<child_title>>\"\n\n            % edit_field \"<<field_name>>\" \"<<field_id>>\" \"<<field_title>>\"\n\n            % action_row \"<<name1>>\" \"<<action_title_1>>\"\n            % action_row \"<<name2>>\" \"<<action_title_2>>\"\n\n            % edit_row \"update\"\n            % delete_row \"delete\"\n\n%% table_footer\n  tr\n    td...-\n    td...-\n    td:::\n        % new_row \"<<new_row_title>>\"\n\n%% table_row_edit\n    {{form.as_table}}\n    {{form.fields_as_table.<<field1>>__<<field2>>__<<field3>>}}\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "Classifier",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/tree.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n\n%% all\n    %with form_width=800 form_height=600 table_type='datatable' title=_(\"Classifier\"):\n        {{ block.super }}\n\n%% list_row_header\n    th..._(Name)\n    th..._(Description)\n\n%% list_row\n    td...{{object.name}}\n    td...{{object.description}}\n\n%% row_edit\n    % if form_add:\n        % form:\n            \"name\",\n            \"description\"\n    % else\n        % form:\n            \"parent\",\n            \"name\",\n            \"description\"\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "Account",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/tree.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                    \"name1\": \"image_path1\",\n                    \"name2\": \"image_path2\",\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% on_dialog_load {:}\n    function show_hide(typ):\n        if (typ=='S'):\n            $('label[for|=\"id_grand_parent\"]').show()\n            $('label[for|=\"id_description\"]').show()\n            $('select[name^=\"grand_parent\"]').show()\n            $('input[name=\"description\"]').show()\n            $('#id_key').show()\n        else:\n            $('label[for|=\"id_grand_parent\"]').hide()\n            $('label[for|=\"id_description\"]').hide()\n            $('select[name^=\"grand_parent\"]').hide()\n            $('input[name=\"description\"]').hide()\n            $('#id_key').hide()\n\n    $('#id_type').change(\n        function():\n            var typ\n            typ = $(this)[0].options[$(this)[0].selectedIndex].value\n            show_hide(typ)\n            return false\n\n    var id_type=$('#id_type')[0].options[$('#id_Typ')[0].selectedIndex].value\n    show_hide(id_type)\n    if(id_type!=\"\"):\n        $('label[for|=\"id_type\"]').hide()\n        $('select[name=\"type\"]').hide()\n\n\n%% all\n    %with table_type='datatable' title=\"Accounts\":\n        {{ block.super }}\n\n\n%% list_row_header\n    th..._(Type 1)\n    th..._(Type 2)\n    th..._(Name)\n    th..._(Description)\n    th..._(Classifier 1)\n    th..._(Classifier 2)\n    th..._(Classifier 3)\n\n%% list_row\n    td...{{object.type1}}\n    td...{{object.type2}}\n    td...{{object.name}}\n    td...{{object.description}}\n    td...{{object.root_classifier1|none_to_empty}}\n    td...{{object.root_classifier2|none_to_empty}}\n    td...{{object.root_classifier3|none_to_empty}}\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .delete\n\n%% row_edit\n    % if form_add\n        % form:\n            .parent:!\n    % else\n        % form:\n            .parent\n    \n    % if object.parent:\n        % form:\n            .type2:!\n    % else:\n        % form:\n            .type2\n                \n    % form: \n        .name,description,correctness_rule,root_classifier1,root_classifier2,root_classifier3\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "AccountDocument",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                    \"<<name1>>\": \"<<image_path1>>\",\n                    \"<<name2>>\": \"<<image_path2>>\",\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with form_width=<<dx>> form_height=<<dy>>\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"<<new_row_title>>\"\n    % action_table \"<<action>>\" \"<<action_title>>\"\n\n%% list_row_header\n    th...<<col_name>>\n\n%% list_row\n    td...{{object.<<object_name>>}}\n\n\n%% list_row_actions\n    {% if not forloop.first %}\n        % row_actions:... field_up,Move up\n    {% endif %}\n    {% if not forloop.last %}\n        % row_actions:...field_down,Move down\n    {% endif %}\n\n    % row_actions:\n        .edit\n        .field_edit/<<field_name>>,<<name>>,<<field_id>>\n        .field_list/<<child_name>>_set,<<field_title>>,<<field_id>>\n        .<<action_name>>,<<action_title>>\n        .delete\n\n\n%% row_edit\n    % form:\n\n    % form:\n            \"<<field_1>>\", \"<<field_2>>\"\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "AccountStack",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                    \"<<name1>>\": \"<<image_path1>>\",\n                    \"<<name2>>\": \"<<image_path2>>\",\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with form_width=<<dx>> form_height=<<dy>>\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"<<new_row_title>>\"\n    % action_table \"<<action>>\" \"<<action_title>>\"\n\n%% list_row_header\n    th...<<col_name>>\n\n%% list_row\n    td...{{object.<<object_name>>}}\n\n\n%% list_row_actions\n    {% if not forloop.first %}\n        % row_actions:... field_up,Move up\n    {% endif %}\n    {% if not forloop.last %}\n        % row_actions:...field_down,Move down\n    {% endif %}\n\n    % row_actions:\n        .edit\n        .field_edit/<<field_name>>,<<name>>,<<field_id>>\n        .field_list/<<child_name>>_set,<<field_title>>,<<field_id>>\n        .<<action_name>>,<<action_title>>\n        .delete\n\n\n%% row_edit\n    % form:\n\n    % form:\n            \"<<field_1>>\", \"<<field_2>>\"\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "AccountMoves",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                    \"<<name1>>\": \"<<image_path1>>\",\n                    \"<<name2>>\": \"<<image_path2>>\",\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with form_width=<<dx>> form_height=<<dy>>\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"<<new_row_title>>\"\n    % action_table \"<<action>>\" \"<<action_title>>\"\n\n%% list_row_header\n    th...<<col_name>>\n\n%% list_row\n    td...{{object.<<object_name>>}}\n\n\n%% list_row_actions\n    {% if not forloop.first %}\n        % row_actions:... field_up,Move up\n    {% endif %}\n    {% if not forloop.last %}\n        % row_actions:...field_down,Move down\n    {% endif %}\n\n    % row_actions:\n        .edit\n        .field_edit/<<field_name>>,<<name>>,<<field_id>>\n        .field_list/<<child_name>>_set,<<field_title>>,<<field_id>>\n        .<<action_name>>,<<action_title>>\n        .delete\n\n\n%% row_edit\n    % form:\n\n    % form:\n            \"<<field_1>>\", \"<<field_2>>\"\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "DocumentLines",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                    \"<<name1>>\": \"<<image_path1>>\",\n                    \"<<name2>>\": \"<<image_path2>>\",\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with form_width=<<dx>> form_height=<<dy>>\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"<<new_row_title>>\"\n    % action_table \"<<action>>\" \"<<action_title>>\"\n\n%% list_row_header\n    th...<<col_name>>\n\n%% list_row\n    td...{{object.<<object_name>>}}\n\n\n%% list_row_actions\n    {% if not forloop.first %}\n        % row_actions:... field_up,Move up\n    {% endif %}\n    {% if not forloop.last %}\n        % row_actions:...field_down,Move down\n    {% endif %}\n\n    % row_actions:\n        .edit\n        .field_edit/<<field_name>>,<<name>>,<<field_id>>\n        .field_list/<<child_name>>_set,<<field_title>>,<<field_id>>\n        .<<action_name>>,<<action_title>>\n        .delete\n\n\n%% row_edit\n    % form:\n\n    % form:\n            \"<<field_1>>\", \"<<field_2>>\"\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "AccountOperation",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='datatable':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"_(New account operation)\"\n\n%% list_row_header\n    th..._(Date)\n    th..._(Description)\n    th..._(Payment)\n    th..._(Account state)\n    th..._(Sign)\n    th..._(Amount)\n\n%% list_row\n    td...{{object.date}}\n    td...{{object.description}}\n    td...{{object.payment}}\n    td...{{object.account_state}}\n    td...{{object.sign}}\n    td...{{object.amount}}\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .delete\n\n%% row_edit\n    % form:\n        .parent,description,payment,account_state\n    % comment:\n        div class=ajax-region,,,data-region=get_row\n            div class=row\n                % get_table_row form.account_state search_fields=\"parent__name__icontains\"\n    % form:\n        .sign,amount\n\n        ",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "DocReg",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='simple':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row _(\"New document register\")\n\n%% list_row_header\n    th..._(name)\n    th..._(description)\n\n%% list_row\n    td...{{object.name}}\n    td...{{object.description}}\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .field_list/doctype_set,Types of documents,doctype_set        \n        .field_list/docregstatus_set,Types of document statuses,docregstatus_set        \n        .field_edit/head_form,Head form,head_form\n        .field_edit/head_template,Head template,head_template\n        .field_edit/item_form,Item form,item_form\n        .field_edit/item_template,Item template,item_template\n        .field_edit/save_head_fun,Save head function,save_head_fun\n        .field_edit/save_item_fun,Save item function,save_item_fun\n        .field_edit/access_fun,Acces functions,access_fun\n        .delete\n\n%% row_edit\n    % form:\n        .app,name,group,description\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "DocHead",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='datatable':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % with object_list.model|args:filter|call:\"get_documents_for_reg\" as doctypes:\n        % for item in doctypes:\n            % new_row \"_(New document:) \"|append_str:item.name action=\"new_row/\"|append_str:item.name\n\n%% list_row_header\n    th..._(Register)\n    th..._(Target)\n    th..._(Name)\n    th..._(Number)\n    th..._(Description)\n    th..._(Date)\n    th..._(Status)\n    \n%% list_row\n    td...{{object.doc_type_parent.name}}\n    td...{{object.org_chart_parent.name}}\n    td...{{object.name}}\n    td...{{object.number}}\n    td...{{object.description}}\n    td...{{object.date|isoformat}}\n    td...{{object.status}}\n\n%% id_extra\n    % row_actions:\n        .field_list/docitem_set,Document items,fa fa-lg fa-plus/fa fa-list-ol        \n    {{ block.super }}\n\n%% list_row_actions\n    % if object.status == \"\" or object.status == 'draft':\n        % row_actions:\n            .edit-inline\n            .delete\n        \n    % with object|args:request|call:\"get_visible_statuses\" as vs:    \n        % if vs:\n            % for row in vs:\n                % if row.order > object.get_reg_status.order:\n                    % action \"approve_status\"|append_str:\"/\"|append_str:row.name row.description row.icon target=row.get_accept_target url=table_path|append_str:\"{id}/action/approve/\"\n\n    % with object|args:request|call:\"get_visible_statuses\" as vs:    \n        % if vs:\n            % for row in vs:\n                % if row.order < object.get_reg_status.order:\n                    % action \"decline_status\"|append_str:\"/\"|append_str:row.name \"_(Back to status:)\"|append_str:row.name row.icon target=row.get_undo_target tag_class=\"+btn-danger\" url=table_path|append_str:\"{id}/action/discard/\"\n\n    % comment:\n        % if object|args:request|call:\"status_can_be_undo\":\n            % action \"decline_status\"|append_str:\"/\"|append_str:object.status \"_(Discard status:) \"|append_str:object.status \"fa fa-undo\" target=object.get_undo_target tag_class=\"+btn-danger\" url=table_path|append_str:\"{id}/action/discard/\"\n\n\n%% row_edit\n    %% dochead_edit\n        % form:\n    % if object.id:\n        %% docitem_list\n            % frame table_path|append_str:object.id|append_str:\"/docitem_set/-/form/sublist/?only_content=1\" \"200px\"\n    % else:\n        <button type=\"button\" class=\"btn btn-warning\" target=\"refresh_frame\" rettype=\"RETURN_HTML_ERROR\" data-region=\"subframe\" get-param=\"redirect='1'\" style=\"width:100%\"> << Expand >> </button>\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "AccountState",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='datatable':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row _(\"Account state\")\n\n%% list_row_header\n    th..._(Account)\n    th..._(Subcode)\n    th..._(Account name)\n    th..._(Target)\n    th..._(Period)\n    th..._(debit)\n    th..._(credit)\n    th..._(element)\n    th..._(classifier1value)\n    th..._(classifier2value)\n    th..._(classifier3value)\n\n%% list_row\n    td...{{object.parent.name}}\n    td...{{object.subcode|none_to_empty}}\n    td...{{object.parent}}\n    td...{{object.target|none_to_empty}}\n    td...{{object.period|none_to_empty}}\n    td...{{object.debit}}\n    td...{{object.credit}}\n    td...{{object.element}}\n    td...{{object.classifier1value|none_to_empty}}\n    td...{{object.classifier2value|none_to_empty}}\n    td...{{object.classifier3value|none_to_empty}}\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .delete\n\n%% row_edit\n    % form:\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "DocType",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='simple':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"_(Document type)\"\n\n%% list_row_header\n    th..._(Name)\n    th..._(Description)\n    th..._(Correction)\n\n%% list_row\n    td...{{object.name}}\n    td...{{object.description}}\n    td...{{object.correction}}\n\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .field_edit/head_form,Head form,head_form\n        .field_edit/item_form,Item form,item_form\n        .field_edit/save_head_fun,Save head function,save_head_fun\n        .field_edit/save_item_fun,Save item function,save_item_fun        \n        .delete\n\n\n%% row_edit\n    % form:\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "DocRegStatus",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='simple':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"_(New status)\"\n\n%% list_row_header\n    th..._(Order)\n    th..._(Name)\n    th..._(Description)\n\n%% list_row\n    td...{{object.order}}\n    td...{{object.name}}\n    td...{{object.description}}\n\n\n%% list_row_actions\n    {% if not forloop.first %}\n        % row_actions:...doc_reg_status_up,Move up,fa fa-caret-square-o-down\n    {% endif %}\n    {% if not forloop.last %}\n        % row_actions:...doc_reg_status_down,Move down,fa fa-caret-square-o-down\n    {% endif %}\n\n    % row_actions:\n        .edit\n        .field_edit/accept_proc,Accept procedure,accept_proc\n        .field_edit/undo_proc,Undo procedure,undo_proc\n        .field_edit/can_set_proc,Check if status can be set\n        .field_edit/can_undo_proc,Check if status can be removed\n        .field_edit/accept_form,Form for acceptance process \n        .field_edit/undo_form,Form for acceptance withdrawal process \n        .delete\n\n\n%% row_edit\n    % form:\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "DocHeadStatus",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='datatable':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n\n%% list_row_header\n    th..._(Date)\n    th..._(Name)\n    th..._(Operator)\n    th..._(Data)\n\n%% list_row\n    td...{{object.date}}\n    td...{{object.name}}\n    td...{{object.operator}}\n    td...{{object.data}}\n\n%% list_row_actions\n\n%% row_edit\n    % form:\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "Form_FilterFormDocHead",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/user_tab.html\"\n\n% load exfiltry\n% load exsyntax\n\n\n%% all\n    %with show_title_bar=1 title='<<form_title>>'\n        {{ block.super }}\n\n\n%% user_header\n    th...<<col_name1>>\n    th...<<col_name2>>\n    th...<<col_name3>>\n\n\n%% user_row\n    tr\n        td... {{object.0}}\n        td align=right... {{object.1|floatnullformat}}\n        td align=right... {{object.2|to_int}}\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "DocItem",
                    "tags_mount": null,
                    "template_code": "% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n% load contenttypes\n\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='simple':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % with parent.doc_type_parent.parent.name|lower as reg_name:\n        % with reg_name|append_str:\"docitem\" as doc_name:\n            % if doc_name|table_exists:\n                % with \"new_row/\"|append_str:reg_name as action:\n                    % new_row \"_(New document item)\" action=action \n            % else\n                % new_row \"_(New document item)\" \n\n%% list_row_header\n    th..._(order)\n    th..._(description)\n    th..._(amount)\n    th..._(level)\n\n%% list_row\n    td...{{object.order}}\n    td...{{object.description}}\n    td...{{object.amount}}\n    td...{{object.level}}\n\n\n%% id_extra\n    % row_actions:\n        .field_list-parent/accountoperation_set,Account operations,fa fa-lg fa-plus/fa fa-list-ol\n    {{ block.super }}\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .delete\n\n%% row_edit\n    % form:\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "admin_delegation_dochead_list",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"schelements/dochead.html\"\n\n% load exfiltry\n% load exsyntax\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "admin_delegation_dochead_edit",
                    "tags_mount": null,
                    "template_code": "% extends \"schelements/dochead.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% dochead_edit\n    % form:\n        .description\n    % get_table_row \"account_id\" \"schelements\" \"Account\" \"name__icontains\" filter=\"1\"\n    ",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "admin_delegation_docitem_list",
                    "tags_mount": null,
                    "template_code": "% extends \"schelements/docitembase.html\"\n\n% load exfiltry\n% load exsyntax\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "DocItemBase",
                    "tags_mount": null,
                    "template_code": "% extends \"schelements/docitem.html\"\n\n% load exfiltry\n% load exsyntax\n\n%%list_content_header_first_row\n\n%%list_content_header_second_row\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "v_approve",
                    "tags_mount": null,
                    "template_code": "% extends 'only_content.html'\n% load exfiltry\n% load exsyntax\n\n\n%% all\n    %with show_form=True form_edit=True\n        % if errors:\n            meta name=RETURN,,,content=$$RETURN_HTML_ERROR\n        {{ block.super }}\n\n%% form_action\n    {{request.path}}?x1={{ action_name }}\n\n%% row_edit_form    \n    % if errors:\n        % for error in errors:\n            div class=alert alert-secondary,,,role=alert\n                {{ error|safe }}\n    % else:\n        % if description:\n            {{ description|safe }}\n        % else:\n            h3..._(Are you sure you want to accept the document)? <br>\n            h4..._(You accept the status): {{ action_name }}\n    % if form:\n        br    \n        % form:\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "v_discard",
                    "tags_mount": null,
                    "template_code": "% extends 'only_content.html'\n% load exfiltry\n% load exsyntax\n\n\n%% all\n    % with show_form=True form_edit=True\n        % if errors:\n            meta name=RETURN,,,content=$$RETURN_HTML_ERROR\n        {{ block.super }}\n\n%% form_action\n    {{request.path}}?x1={{ action_name }}\n\n%% row_edit_form    \n    % if errors:\n        % for error in errors:\n            div class=alert alert-secondary,,,role=alert\n                {{ error|safe }}\n    % else:\n        % if description:\n            {{ description|safe }}\n        % else:\n            h3..._(Are you sure you want to discard the document)? <br>\n            h4..._(You discard the status): {{ action_name }}\n    % if form:\n        br    \n        % form:\n",
                    "url": null,
                    "url_parm": null
                }
            ],
            [
                {
                    "icon": "bi-stack",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Elements",
                    "perms": "schelements.admin_element",
                    "url": "table/Element/0/form/tree/",
                    "url_type": "desktop"
                },
                {
                    "icon": "client://actions/folder-new.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Documents register",
                    "perms": "schelements.admin_docreg",
                    "url": "table/DocReg/-/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": null,
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Types of documents",
                    "perms": "schelements.admin_doctype",
                    "url": "table/DocType/-/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": null,
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Definition of document status",
                    "perms": "schelements.admin_docregstatus",
                    "url": "table/DocRegStatus/-/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": "client://apps/system-file-manager.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Accounts",
                    "perms": "schelements.admin_account",
                    "url": "table/Account/0/form/tree/",
                    "url_type": "desktop"
                },
                {
                    "icon": "client://mimetypes/package-x-generic.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "States of accounts",
                    "perms": "schelements.admin_accountstate",
                    "url": "table/AccountState/-/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": "client://actions/edit-find-replace.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Account operations",
                    "perms": "schelements.admin_accountoperation",
                    "url": "table/AccountOperation/-/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": "client://actions/format-justify-fill.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Documents",
                    "perms": "schelements.admin_accountoperation",
                    "url": "table/DocHead/-/form/list/",
                    "url_type": "desktop"
                }
            ],
            [
                [
                    {
                        "asynchronous": false,
                        "doc": "",
                        "end_class_code": "def process_empty_or_invalid(self, request, queryset):\n    return queryset.filter(date__gte = year_ago())\n    ",
                        "end_code": "",
                        "module": null,
                        "name": "_FilterFormDocHead",
                        "process_code": "date_from = self.cleaned_data['date_from']\ndate_to = self.cleaned_data['date_to']\ntarget = self.cleaned_data['target']\nnumber = self.cleaned_data['number']\n\nif date_from:\n    queryset = queryset.filter(date__gte = date_from)\nif date_to:\n    queryset = queryset.filter(date__lt = date_to + datetime.timedelta(days=1))\nif target:\n    queryset = queryset.filter(parent_element__name__icontains = target)\nif number:\n    queryset = queryset.filter(number__icontains = number)\n\nreturn queryset\n"
                    },
                    [
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": "year_ago",
                            "label": "Date from",
                            "name": "date_from",
                            "param": null,
                            "required": false,
                            "type": "DateField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Data to",
                            "name": "date_to",
                            "param": null,
                            "required": false,
                            "type": "DateField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Target",
                            "name": "target",
                            "param": "max_length=None, min_length=None",
                            "required": false,
                            "type": "CharField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Number",
                            "name": "number",
                            "param": "max_length=None, min_length=None",
                            "required": false,
                            "type": "CharField",
                            "widget": null
                        }
                    ]
                ],
                [
                    {
                        "asynchronous": false,
                        "doc": "",
                        "end_class_code": "def process_empty_or_invalid(self, request, queryset):\n    if not self.is_bound:\n        return queryset\n        \n    if self.data['account_target']:\n        queryset = queryset.filter(target__id = int(self.data['account_target'][0]))\n    if self.cleaned_data['account']:\n        pass\n    if self.cleaned_data['classifier1']:\n        pass\n    if self.cleaned_data['classifier2']:\n        pass\n    if self.cleaned_data['classifier3']:\n        pass\n    if self.cleaned_data['subcode']:\n        pass\n\n    if self.cleaned_data['period']:\n        if self.cleaned_data['period'] == '*':\n            pass\n        else:\n            queryset = queryset.filter(period=self.cleaned_data['period'])\n    else:\n        queryset = queryset.filter(Q(period__isnull=True)|Q(period=\"\"))\n\n    if self.cleaned_data['not_null']:\n        queryset = queryset.exclude(debit=F('credit'))\n\n    if self.cleaned_data['not_empty']:\n        queryset = queryset.exclude(debit=0,credit=0)\n\n    if self.cleaned_data['analytical']:\n        queryset = queryset.filter(aggregate=False)\n\n    return queryset\n",
                        "end_code": "",
                        "module": null,
                        "name": "_FilterFormAccountState",
                        "process_code": "return self.process_empty_or_invalid(request, queryset)\n"
                    },
                    [
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Target",
                            "name": "account_target",
                            "param": "queryset=models.Element.objects.filter(type='O-DIV'), search_fields=['name__istartswith'], attrs={'data-minimum-input-length': 0}",
                            "required": false,
                            "type": "ModelSelect2Field",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Account",
                            "name": "account",
                            "param": "queryset=models.Account.objects.all(), search_fields=['name__istartswith'], attrs={'data-minimum-input-length': 0}",
                            "required": false,
                            "type": "ModelSelect2Field",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Classifier 1",
                            "name": "classifier1",
                            "param": "max_length=None, min_length=None",
                            "required": false,
                            "type": "CharField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Classifier 2",
                            "name": "classifier2",
                            "param": "max_length=None, min_length=None",
                            "required": false,
                            "type": "CharField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "classifier3",
                            "name": "classifier3",
                            "param": "max_length=None, min_length=None",
                            "required": false,
                            "type": "CharField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Subcode",
                            "name": "subcode",
                            "param": "max_length=None, min_length=None",
                            "required": false,
                            "type": "CharField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Period",
                            "name": "period",
                            "param": "max_length=None, min_length=None",
                            "required": false,
                            "type": "CharField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Not null",
                            "name": "not_null",
                            "param": null,
                            "required": false,
                            "type": "BooleanField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Not empty",
                            "name": "not_empty",
                            "param": null,
                            "required": false,
                            "type": "BooleanField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Analytical",
                            "name": "analytical",
                            "param": null,
                            "required": false,
                            "type": "BooleanField",
                            "widget": null
                        }
                    ]
                ]
            ],
            [],
            [],
            [
                {
                    "content": "from django import template\n\nregister = template.Library()\n\n\n@register.filter(name=\"dochead_prefetch\")\ndef dochead_prefetch(object_list):\n    l = object_list\n    for related in ['doc_type_parent', 'doc_type_parent__parent', 'doc_type_parent__parent__docregstatus_set']:\n        l = l.prefetch_related(related)\n    return l\n\n@register.filter(name=\"dochead_report_prefetch\")\ndef dochead_report_prefetch(object_list):\n    l = object_list\n    for related in ['doc_type_parent', 'doc_type_parent__parent', 'doc_type_parent__parent__docregstatus_set', 'report_set']:\n        l = l.prefetch_related(related)\n    return l\n",
                    "file_type": "f",
                    "name": "elements"
                }
            ]
        ],
        [
            {
                "consumer_code": "",
                "doc": null,
                "icon": "None",
                "icon_code": null,
                "icon_size": "1",
                "index": null,
                "jsondata": null,
                "model_code": "from pytigon_lib.schtools.schjson import json_dumps, json_loads\n#from schlib.schdjangoext.django_ihtml import ihtml_to_html\n#from django.template import Context, Template\nfrom django.db.models import Max, Min\n\nfrom schelements.models import *",
                "module_title": "Data structures",
                "name": "schreports",
                "perms": true,
                "tasks_code": "",
                "title": "Reports",
                "urls_code": null,
                "user_param": "",
                "view_code": "from pytigon_lib.schtools.schjson import json_dumps, json_loads\nfrom pytigon_lib.schdjangoext.django_ihtml import ihtml_to_html\nfrom pytigon_lib.schdjangoext.fastform import form_from_str\nfrom pytigon_lib.schviews import make_path\nfrom schelements.models import DocReg, DocType, DocHead, Element\nfrom django.db.models import F\nfrom schelements.views import year_ago\n\ndef move_rep(request, id, to_pos = \"+1\"):\n    obj = models.Report.objects.get(pk=id)\n    url = make_path('ok')\n    if not obj.parent:\n        return HttpResponseRedirect(url)\n    \n    if type(to_pos)==str:\n        if to_pos==\"+1\":\n            objects = models.Report.objects.filter(parent = obj.parent).filter(order__gt = obj.order)\n            if len(objects)>0:\n                obj2 = objects[0]\n            else: \n                return HttpResponseRedirect(url)\n        elif to_pos=='-1':    \n            objects = models.Report.objects.filter(parent = obj.parent).filter(order__lt = obj.order)\n            if len(objects)>0:\n                obj2 = list(objects)[-1]\n            else: \n                return HttpResponseRedirect(url)\n                \n        tmp_order = obj.order\n        obj.order = obj2.order\n        obj2.order = tmp_order\n        obj.save()\n        obj2.save()\n        \n    elif type(to_pos)==int:\n        obj2 = models.Report.objects.get(pk=to_pos)\n        order = obj2.order\n        if obj.order < order:\n            objects = models.Report.objects.filter(parent = obj.parent).filter(order__gt = obj2.order).update(order=F('order')+2)\n            obj.order = order+1\n        else:\n            objects = models.Report.objects.filter(parent = obj.parent).filter(order__gte = obj2.order).update(order=F('order')+2)\n            obj.order = order\n        obj.save()\n\n    return actions.refresh(request)\n"
            },
            [
                [
                    {
                        "base_table": "schelements.BaseObject",
                        "doc": "Declaration:\n    return Form()\n\nTemplate: django template\n\nchild(name):\n    child_header(name)\n    child_table(name)\n    \n    <html></html>\n\n\n\nto_html:\n    convert form data to html\n    \n",
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_repdef\", \"Can administer report definitions\"),\n]\n",
                        "name": "ReportDef",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.name\n\ndef getsubrep(self, name):\n    return ReportDef.objects.get(name = self.name + \"/\" + name)\n    \n@staticmethod    \ndef get_rep_defs():\n    repdef_list = ReportDef.objects.exclude(name__contains='/')\n    return repdef_list\n\ndef can_user_add(self, user):\n    if self.doc_type:\n        return DocHead.can_add(self.doc_type, user)\n    else:\n        return True\n\ndef copy_to_clipboard(self):\n    return { \n        'action': 'paste_from_clipboard',\n        'table': 'ReportDef',\n        'objects': [\n            {   'app': self.app,\n                'name': self.name,\n                'description': self.description,\n                'declaration': self.declaration,\n                'template_src': self.template_src,\n                'template': self.template,\n                'to_html_rec': self.to_html_rec,\n                'save_fun': self.save_fun,\n                'load_fun': self.load_fun,\n                'to_str_fun': self.to_str_fun,\n                'action_template': self.action_template,\n                'doc_type': self.doc_type,\n            },\n        ]\n    }\n\n@classmethod\ndef table_action(cls, list_view, request, data):\n    if 'action' in data and data[\"action\"] == \"paste_from_clipboard\" and 'table' in data and data['table'] == 'ReportDef':\n        object_list = data['objects']\n        for obj_param in object_list:\n            obj = ReportDef()\n            obj.app = obj_param['app']\n            obj.name = \"COPY: \" + obj_param['name']\n            obj.description = obj_param['description']\n            obj.declaration = obj_param['declaration']\n            obj.template_src = obj_param['template_src']\n            obj.template = obj_param['template']\n            obj.to_html_rec = obj_param['to_html_rec']\n            obj.save_fun = obj_param['save_fun']\n            obj.load_fun = obj_param['load_fun']\n            obj.to_str_fun = obj_param['to_str_fun']\n            obj.action_template = obj_param['action_template']\n            obj.doc_type = obj_param['doc_type']\n            obj.save()\n        print(\"PASTE: \", data)\n        return True\n    return standard_table_action(cls, list_view, request, data, [\"copy\", \"paste\"])\n",
                        "url_params": null,
                        "verbose_name": "Report definition",
                        "verbose_name_plural": "Reports definitions"
                    },
                    [
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Associated document type",
                            "editable": true,
                            "help_text": null,
                            "name": "doc_type",
                            "null": true,
                            "param": "max_length=16",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": "JSONModel",
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "ordering = ['parent_id', 'order', 'id']\n\npermissions = [\n    (\"admin_report\", \"Can administer reports\"),\n]\n",
                        "name": "Report",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.report_def_name\n\ndef template_for_object(self, view, context, doc_type):\n    if doc_type=='pdf':\n        x = ReportDef.objects.filter(name=self.report_def_name)\n        if x.count()>0:\n            return \"%s/report_%s_pdf.html\" % (x[0].app, self.report_def_name)\n    return None\n\n@staticmethod    \ndef get_rep_types():\n    repdef_list = ReportDef.objects.exclude(name__contains='/')\n    return [pos.name for pos in repdef_list]\n\n\n@staticmethod    \ndef get_rep_by_nagid(nagid):\n    r = Report.objects.filter(parent_doc__id=nagid)\n    if r.count()>0:\n        return r[0]\n    else:\n        return None\n\n\n@classmethod\ndef filter(cls, value, view=None, request=None):\n    if value == 'main_reports':\n        return Report.objects.filter(parent=None)\n    else:\n        return Report.objects.all()\n\ndef getsubreps(self, name):\n    return Report.objects.filter(parent=self).filter(report_def_name__endswith=name)\n        \ndef to_html(self):\n    rep_def = ReportDef.objects.get(name = self.report_def_name)\n    return rep_def.to_html(self)\n\n#def  __getattr__(self, name):    \n#    if name.startswith('json_'):\n#        if not hasattr(self, '_data'):\n#            self._data = json_loads(self.data)\n#        if name[5:] in self._data:\n#            return self._data[name[5:]]\n#        else:\n#            return None\n#    else:\n#        return super().__getattr__(name)\n\ndef save(self, *args, **kwargs):\n    if self.pk is None:\n        if self.parent:\n            m = Report.objects.filter(parent=self.parent).aggregate(Max('order'))['order__max']\n            if m:\n                self.order = m + 1\n            else:\n                self.order = 1        \n    super().save(*args, **kwargs)\n\n\n\n",
                        "url_params": null,
                        "verbose_name": "Report",
                        "verbose_name_plural": "Reports"
                    },
                    [
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Parent",
                            "editable": false,
                            "help_text": null,
                            "name": "parent",
                            "null": true,
                            "param": null,
                            "rel_to": "'self'",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Parent document",
                            "editable": false,
                            "help_text": null,
                            "name": "parent_doc",
                            "null": true,
                            "param": null,
                            "rel_to": "schelements.DocHead",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Order number",
                            "editable": true,
                            "help_text": null,
                            "name": "order",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "IntegerField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Report definition name",
                            "editable": true,
                            "help_text": null,
                            "name": "report_def_name",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Date",
                            "editable": true,
                            "help_text": null,
                            "name": "date",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "DateTimeField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_plot\", \"Can administer plots\"),\n]\n",
                        "name": "Plot",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.name",
                        "url_params": null,
                        "verbose_name": "Plot",
                        "verbose_name_plural": "Polts"
                    },
                    [
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Name",
                            "editable": true,
                            "help_text": null,
                            "name": "name",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Group",
                            "editable": true,
                            "help_text": null,
                            "name": "group",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Get config",
                            "editable": false,
                            "help_text": null,
                            "name": "get_config",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Get data",
                            "editable": false,
                            "help_text": null,
                            "name": "get_data",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Get layout",
                            "editable": false,
                            "help_text": null,
                            "name": "get_layout",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "On event",
                            "editable": false,
                            "help_text": null,
                            "name": "on_event",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Permission",
                            "editable": true,
                            "help_text": null,
                            "name": "permission",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ]
            ],
            [],
            [
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "new_rep",
                    "param": "rep_type,  doc_type_name",
                    "ret_type": "U",
                    "url": "new_rep/(?P<rep_type>\\w+)/(?P<doc_type_name>\\w+)/$",
                    "url_params": "{}",
                    "view_code": "#new_rep/(?P<rep_type>\\w+)/(?P<doc_type_name>\\w+)/$\ndoc_type = DocType.objects.filter(name=doc_type_name)\nif len(doc_type)==1:\n    doc = DocHead()\n    doc.doc_type_parent = doc_type[0]\n    doc.date = datetime.datetime.now()\n    doc.status = 'edit'\n    doc.operator = request.user.username\n    doc.save()\n    \n    rep = models.Report()\n    rep.parent = None\n    rep.order = 0\n    rep.parent_doc = doc\n    rep.report_def_name = rep_type\n    rep.date = datetime.datetime.now()\n    rep.save()\n    url = make_href(\"/schreports/table/Report/%d/edit__rep/\" % rep.id)\n    return HttpResponseRedirect(url)\nelse:\n    return HttpResponse(\"Error - document type: %s doesn't exists\" % doc_type_name)\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "edit__rep",
                    "param": "rep_id, rep=None",
                    "ret_type": "U",
                    "url": "table/Report/(?P<rep_id>\\d+)/edit__rep/$",
                    "url_params": "{}",
                    "view_code": "if rep==None:\n    rep = models.Report.objects.get(pk=rep_id)\nrep_def = models.ReportDef.objects.get(name=rep.report_def_name)\n\nif rep_def.declaration:\n    form_class = form_from_str(rep_def.declaration)\nelse:\n    return \"ERROR\"\n\nif request.POST or request.FILES:\n    if request.method == \"POST\":\n        form = form_class(request.POST, request.FILES)\n        if form.is_valid():\n            if rep_def.save_fun:\n                exec(rep_def.save_fun)\n                data = locals()[\"save\"](form, rep)\n            else:\n                data = form.cleaned_data\n            if data != None:\n                rep.jsondata = data\n                rep.save()\n                url = make_path(\"ok\")\n                return HttpResponseRedirect(url)\n\nif not request.POST:\n    data = rep.get_json_data()\n\n    if rep_def.load_fun:\n        exec(rep_def.load_fun)\n        data_form = locals()[\"load\"](data)\n    else:\n        data_form = data\n    form = form_class(initial=data_form)\n\nt = Template(ihtml_to_html(None, rep_def.template))\nc = RequestContext(request, {\"form\": form, \"rep\": rep, \"rep_def\": rep_def})\n\nreturn HttpResponse(t.render(c))\n\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "new_subrep",
                    "param": "parent_rep_id, rep_type",
                    "ret_type": "U",
                    "url": "new_subrep/(?P<parent_rep_id>\\d+)/(?P<rep_type>\\w+)/$",
                    "url_params": "{}",
                    "view_code": "rep_parent = models.Report.objects.get(pk=parent_rep_id)\nrep = models.Report()\nrep.parent = rep_parent\nrep.order = 0\nrep.report_def_name = rep_parent.report_def_name + \"/\" + rep_type\nrep.date = datetime.datetime.now()\nreturn edit__rep(request, 0, rep)\n\n#rep_parent = models.Report.objects.get(pk=parent_rep_id)\n#rep = models.Report()\n#rep.parent = rep_parent\n#rep.order = 0\n#rep.report_def_name = rep_parent.report_def_name + \"/\" + rep_type\n#rep.date = datetime.datetime.now()\n#rep.save()\n#url = make_href(\"/schreports/table/Report/%d/edit__rep/\" % rep.id)\n#return HttpResponseRedirect(url)\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "edit_subrep",
                    "param": "parent_rep_id, rep_type,view_type",
                    "ret_type": "U",
                    "url": "edit_subrep/(?P<parent_rep_id>\\d+)/(?P<rep_type>\\w+)/(?P<view_type>\\w+)/$",
                    "url_params": "{}",
                    "view_code": "parent_rep = models.Report.objects.get(pk=parent_rep_id)\nparent_rep_def = models.ReportDef.objects.get(name=parent_rep.report_def_name)\nrep_def = parent_rep_def.getsubrep(rep_type)\nsubreps = parent_rep.getsubreps(rep_type)\n\ncdict = {}    \ncdict['parent_rep'] = parent_rep\ncdict['parent_rep_def'] = parent_rep_def\ncdict['rep_type'] = rep_type\ncdict['view_type'] = view_type\ncdict['reports']= parent_rep.getsubreps(rep_type)\ncdict['rep_def'] = rep_def\n\ntxt = ihtml_to_html(None, rep_def.to_html_rec)\nt = Template(txt)\nc = RequestContext(request,cdict)\n\nreturn HttpResponse(t.render(c))\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "move_up",
                    "param": "pk",
                    "ret_type": "U",
                    "url": "Report",
                    "url_params": null,
                    "view_code": "return move_rep(request, pk, \"-1\")\n",
                    "view_type": "r"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "move_down",
                    "param": "pk",
                    "ret_type": "U",
                    "url": "Report",
                    "url_params": null,
                    "view_code": "return move_rep(request, pk, \"+1\")",
                    "view_type": "r"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "edit__rep2",
                    "param": "dochead_id",
                    "ret_type": "U",
                    "url": "table/Report/(?P<dochead_id>\\d+)/edit__rep2/$",
                    "url_params": "{}",
                    "view_code": "reps = models.Report.objects.filter(parent_doc__id=dochead_id)\nif reps.count()>0:\n    new_url = make_href(\"/schreports/table/Report/%d/edit__rep/\" % reps[0].id)\n    return HttpResponseRedirect(new_url)\nelse:\n    return HttpResponse(\"Error - report doesn't exist\")\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "repaction",
                    "param": "dochead_id, rep_action",
                    "ret_type": "U",
                    "url": "table/Report/(?P<dochead_id>\\d+)/repaction/(?P<rep_action>\\w+)/$",
                    "url_params": "{}",
                    "view_code": "doc = DocHead.objects.get(pk=dochead_id)\nreps = models.Report.objects.filter(parent_doc=doc)\nif reps.count()>0:\n    url = make_href(\"/schreports/table/Report/%d/%s/\" % (reps[0].id, rep_action.replace('__','/')))\n    return HttpResponseRedirect(url)\nelse:\n    return HttpResponse(\"Error - document: %d doesn't exists\" % dochead_id)\n    \n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "move_to",
                    "param": "rep_id, to_pos",
                    "ret_type": "U",
                    "url": "table/Report/(?P<rep_id>\\d+)/(?P<to_pos>\\d+)/action/move_to/$",
                    "url_params": "{}",
                    "view_code": "return move_rep(request, rep_id, int(to_pos))\n\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "plot_service",
                    "param": "**argv",
                    "ret_type": "J",
                    "url": "plot_service/(?P<name>\\w+)/$",
                    "url_params": "{}",
                    "view_code": "if 'param' in request.GET:\n    request_param = request.GET['param']\nelse:\n    request_param = None\n    \nparam = json_loads(request.body.decode('utf-8'))\n\naction = param['action']\nname = param['name']\n\nobjs = models.Plot.objects.filter(name=name)\nif len(objs) == 1:\n    obj = objs[0]\nelse:\n    obj = None\n\nif obj:\n    if action == 'get_config':\n        if obj.get_config:\n            tmp = \"def _get_config(request_param):\\n\" + \"\\n\".join([ \"    \" + pos for pos in obj.get_config.split('\\n')])\n            exec(tmp)\n            config = locals()['_get_config'](request_param)        \n        else:\n            config = {\n                'displayModeBar': False, \n                'showLink': False, \n                'displaylogo': False, \n                'scrollZoom': True, \n                'modeBarButtonsToRemove': ['sendDataToCloud'],\n            }\n        return config\n    elif action == 'get_data':\n        if obj.get_data:\n            tmp = \"def _get_data(request_param):\\n\" + \"\\n\".join([ \"    \" + pos for pos in obj.get_data.split('\\n')])\n            exec(tmp)\n            data = locals()['_get_data'](request_param)        \n        else:\n            data = {}\n        return data\n    elif action == 'get_layout':\n        if obj.get_layout:\n            tmp = \"def _get_layout(request_param):\\n\" + \"\\n\".join([ \"    \" + pos for pos in obj.get_layout.split('\\n')])\n            exec(tmp)\n            layout = locals()['_get_layout'](request_param)        \n        else:\n            layout = {}\n        return layout\n    elif action == 'on_event':\n        if obj.on_event:\n            tmp = \"def _on_event(data, request_param):\\n\" + \"\\n\".join([ \"    \" + pos for pos in obj.on_event.split('\\n')])\n            exec(tmp)\n            ret = locals()['_on_event'](param, request_param)                    \n            return ret\n        else:\n            return {}\n    else:\n        return { 'error': 'Action not found'}\n        \nreturn { 'error': 'Plot object not found'}\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "new_group",
                    "param": "group_type, parent_id",
                    "ret_type": "U",
                    "url": "new_group/(?P<group_type>\\w+)/(?P<parent_id>\\d+)/$",
                    "url_params": "{}",
                    "view_code": "#new_group/(?P<group_type>\\w+)/(?P<parent_id\\d+)/$\nif parent_id and int(parent_id)>0:\n    parent = models.CommonGroup.objects.get(id=int(parent_id))\nelse:\n    parent = None\ngroup = models.CommonGroup()\nif parent:\n    group.parent = parent\n    gparent  = parent\n    while gparent.parent:\n        gparent = gparent.parent\n    group.gparent =gparent\n    group.gp_group_def_name = gparent.group_def_name    \nelse:\n    group.gp_group_def_name = group_type\n    \ngroup.group_def_name = group_type\ngroup.save()\n\nif not group.gparent:\n    group.gparent = group\n    group.save()\n    \nurl = make_href(\"/schreports/table/CommonGroup/%d/edit__group/\" % group.id)\nreturn HttpResponseRedirect(url)\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "edit__group",
                    "param": "group_id",
                    "ret_type": "U",
                    "url": "table/CommonGroup/(?P<group_id>\\d+)/edit__group/$",
                    "url_params": "{}",
                    "view_code": "group = models.CommonGroup.objects.get(pk=group_id)\ngroup_def = models.CommonGroupDef.objects.get(name=group.group_def_name)\n\nif group_def.declaration:\n    form_class = form_from_str(group_def.declaration)\nelse:\n    return HttpResponse(\"ERROR\")\n    \nif request.POST or request.FILES:    \n    if request.method == 'POST':\n        form = form_class(request.POST, request.FILES)\n        if form.is_valid():\n            if group_def.save_fun:\n                exec(group_def.save_fun)\n                data = locals()['save'](form, group)\n            else:\n                data = form.cleaned_data\n            \n            if not data:\n                data = {}\n            \n            if 'title' in data:\n                group.title = data['title']\n                del data['title']\n            group.jsondata = data\n            #group._data = data\n            #group._data['json_update'] = True\n            group.save()\n            url = make_path('ok')\n            return HttpResponseRedirect(url)\n    \nif not request.POST:\n    data = group.get_json_data()\n    \n    if group_def.load_fun:\n        exec(group_def.load_fun)\n        data_form = locals()['load'](data)\n    else:\n        data_form = data\n\n    if not data:\n        data = {}\n\n    data_form['title'] = group.title\n    form = form_class(initial=data_form)\n\nt = Template(ihtml_to_html(None, group_def.template))\nc = RequestContext(request, { 'form': form, 'group': group, 'group_def': group_def})\n\nreturn HttpResponse(t.render(c))\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "list_group_by_tag",
                    "param": "group_tag",
                    "ret_type": "U",
                    "url": "list_group_by_tag/(?P<group_tag>\\w+)/$",
                    "url_params": "{}",
                    "view_code": "groups = models.CommonGroup.objects.filter(tag_name=group_tag)\nif len(groups)>0:\n    group = groups[0]\n    url = make_href(\"/schreports/table/CommonGroup/%d/%d/form/tree/?only_content=1\" % (group.id, group.id))\nelse:\n    url = make_href(\"/schreports/table/CommonGroup/0/form/tree/?only_content=1\")\nreturn HttpResponseRedirect(url)    \n",
                    "view_type": "u"
                }
            ],
            [
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "ReportDef",
                    "tags_mount": null,
                    "template_code": "% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    % with table_type='datatable':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"New report definition\"\n    ptig-paste href=../table_action/\n    \n%% list_row_header\n    th..._(name)\n    th..._(description)\n\n%% list_row\n    td...{{object.name}}\n    td...{{object.description}}\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .field_edit/declaration,Declaration,declaration\n        .field_edit/template,Template,template\n        .field_edit/to_html_rec,To html row,to_html_rec\n        .field_edit/save_fun,Save function,save_fun\n        .field_edit/load_fun,Load function,load_fun\n        .delete\n\n%% row_edit\n    % form:\n        .app,name,description,doc_type\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "Report",
                    "tags_mount": null,
                    "template_code": "% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    % with table_type='simple':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions    \n    div class=tr d-inline\n        _(New): \n        % for pos in object_list.model.get_rep_types:        \n            % new_row_inline pos \"\" \"\" \"\" \"\" \"{{base_path}}schreports/new_rep/\"|append_str:pos|append_str:\"/0/\" \n\n%% list_row_header\n    th..._(Report type)\n    th..._(Date)\n\n%% list_row\n    td...{{object.report_def_name}}\n    td...{{object.date|isoformat}}\n\n%% list_row_actions\n    % row_actions:\n        .edit-inline,_(Update),,,,,{{base_path}}schreports/table/Report/{id}/edit__rep/        \n        .pdf\n        .odf        \n        .field_edit/data,Data,data        \n        .delete\n        \n%% row_edit\n    % form:\n        \"parent\", \"parent_field_name\", \"order\", \"report_def_name\", \"date\"\n\n%% dialog_type\n    .modal-max\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "subreport",
                    "tags_mount": null,
                    "template_code": "% load exfiltry\n% load exsyntax\n    \n% subform href\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "v_edit_subrep",
                    "tags_mount": null,
                    "template_code": "% load exfiltry\n% load exsyntax\n\ndiv class=form-group\n    %% header_new_button\n        div class=row\n            div class=tr d-inline\n                % new_row \"+ \"|append_str:rep_def.description \"\" \"\" \"\" \"-\" \"{{base_path}}schreports/new_subrep/\"|append_str:parent_rep.id|append_str:\"/\"|append_str:rep_type|append_str:\"/\"            \n    \n    div class=row\n        %% header\n        \n        % for object in reports:\n            div class={% block subreport_item_width %}col-1{% endblock %},,,style=position:relative;display:inline-block;\n                %% rep_line\n                div class=fab,,,style=transform:scale(0.5); -webkit-transform:scale(0.5); -moz-transform:scale(0.5); -o-transform:scale(0.5); margin-left: -40px;\n                    nav class=menu\n                        input type=checkbox,,,href=#,,,class=menu-open,,,name=menu-open,,,id=menu-open-subrep-{{forloop.counter0}}\n                        label class=menu-open-button,,,for=menu-open-subrep-{{forloop.counter0}},,,draggable=true,,,ondrop=subreport_drop(event,'{{base_path}}');,,,ondragstart=subreport_dragstart(event);,,,ondragenter=subreport_ondragenter(event);,,,ondragleave=subreport_ondragleave(event);,,,ondragover=subreport_ondragover(event);,,,name={{object.id}}\n                            h4...{{forloop.counter}}\n                            span class=fa fa-bars fa-3x\n                            \n                        a class=menu-item,,,data-inline=,,,true,,,href={{base_path}}schreports/table/Report/{{object.id}}/action/move_up/,,,name=move_up,,,title=Move up,,,target=refresh_frame\n                            i class=fa fa-hand-o-left fa-2x\n\n                        a class=menu-item bg-primary popup,,,href={{base_path}}schreports/table/Report/{{object.id}}/edit__rep/,,,name=update/inline,,,title=update,,,target=popup_edit\n                            i class=fa fa-pencil-square-o fa-2x\n                            \n                        a class=menu-item bg-danger popup,,,href={{base_path}}schreports/table/Report/{{object.id}}/delete/,,,name=delete,,,title=delete,,,target=popup_delete\n                            i class=fa fa-trash-o fa-2x\n                                                                                            \n                        a class=menu-item,,,data-inline=true,,,href={{base_path}}schreports/table/Report/{{object.id}}/action/move_down/,,,name=move_down,,,title=Move down,,,target=refresh_frame\n                            i class=fa fa-hand-o-right fa-2x\n        %% footer\n        \n    %% footer_new_button\n        div class=row\n            div class=tr d-inline new-subreport\n                % new_row \"+ \"|append_str:rep_def.description \"\" \"\" \"\" \"-\" \"{{base_path}}schreports/new_subrep/\"|append_str:parent_rep.id|append_str:\"/\"|append_str:rep_type|append_str:\"/\"            \n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "Form_FilterFormReport",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/user_tab.html\"\n\n% load exfiltry\n% load exsyntax\n\n\n%% all\n    %with show_title_bar=1 title='<<form_title>>'\n        {{ block.super }}\n\n\n%% user_header\n    th...<<col_name1>>\n    th...<<col_name2>>\n    th...<<col_name3>>\n\n\n%% user_row\n    tr\n        td... {{object.0}}\n        td align=right... {{object.1|floatnullformat}}\n        td align=right... {{object.2|to_int}}\n\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "check",
                    "tags_mount": null,
                    "template_code": "% if is_checked:\n    img class=checkbox,,,src=file:///static/fonts/fork-awesome/fonts/32x32/check.png\n% else:\n    img class=checkbox,,,src=file:///static/fonts/fork-awesome/fonts/32x32/square-o.png\n&nbsp;&nbsp;{{title|safe}}\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "Plot",
                    "tags_mount": null,
                    "template_code": "% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='datatable':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"New plot\"\n\n%% list_row_header\n    th..._(name)\n    th..._(group)\n    th..._(permission)\n\n%% list_row\n    td...{{object.name}}\n    td...{{object.group}}\n    td...{{object.permission}}\n\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .field_edit/get_config,Get config,get_config\n        .field_edit/get_data,Get data,get_data\n        .field_edit/get_layout,Get layout,get_layout\n        .field_edit/on_event,On event,on_event\n        .delete\n\n%% row_edit\n    % form:\n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "CommonGroup",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/tree.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with form_width=800 form_height=600 table_type='simple' title=_(\"Common Groups\"):\n        {{ block.super }}\n\n%% list_content_actions_new_row\n    div class=tr d-inline\n        % with object_list.model|args:parent_pk|call:\"get_group_types\" as tab:\n            % if tab:\n                ._(New): \n                % for pos in tab:\n                    % new_row_inline pos.description \"\" \"\" \"\" \"\" table_path|append_str:\"../../new_group/\"|append_str:pos.name|append_str:\"/\"|append_str:parent_pk|append_str:\"/\"\n\n%% list_row_header\n    th...Title\n\n%% list_row\n    td...{{object.to_str|safe }}\n        \n%% list_row_actions\n    % if object.get_def.action_template:\n        {% subtemplate object.get_def.get_action_template %}\n    % else:\n        % row_actions:\n            .edit-inline,_(Update),,,,,{{base_path}}schreports/table/CommonGroup/{id}/edit__group/\n            .pdf\n            .odf        \n            .field_edit/data,Data,data        \n            .delete\n\n%% row_edit\n    % form:\n        \n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "CommonGroupDef",
                    "tags_mount": null,
                    "template_code": "{# -*- coding: utf-8 -*- #}\n% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='datatable':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"New group definition\"\n\n%% list_row_header\n    th...Name\n    th...Description\n    th...Main group\n\n%% list_row\n    td...{{object.name}}\n    td...{{object.description}}\n    td...{{object.main_group}}\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .field_edit/declaration,Declaration,declaration\n        .field_edit/template,Template,template\n        .field_edit/to_html_rec,To html row,to_html_rec\n        .field_edit/save_fun,Save function,save_fun\n        .field_edit/load_fun,Load function,load_fun\n        .field_edit/on_new_elem_event,On new element,on_new_elem_event\n        .field_edit/allowed_new_fields,Allowed new fields,allowed_new_fields\n        .field_edit/to_str_fun,Convert to string function,to_str_fun\n        .field_edit/action_template,Action template,action_template\n        .delete\n\n%% row_edit\n    % form:\n        .app,name,description,main_group\n\n",
                    "url": null,
                    "url_parm": null
                }
            ],
            [
                {
                    "icon": "client://actions/document-properties.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Report definition",
                    "perms": "schreports.admin_repdef",
                    "url": "table/ReportDef/-/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": "client://actions/format-justify-fill.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Reports",
                    "perms": "schreports.admin_report",
                    "url": "table/Report/main_reports/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": "fa://pencil-square.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Plots",
                    "perms": "schreports.admin_plot",
                    "url": "table/Plot/-/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": "png://apps/system-file-manager.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Common group definitons",
                    "perms": "schreports.admin_commongroupdef",
                    "url": "table/CommonGroupDef/-/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": "png://apps/system-file-manager.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Common groups",
                    "perms": "schreports.admin_commongroup",
                    "url": "table/CommonGroup/0/form/tree/",
                    "url_type": "desktop"
                }
            ],
            [
                [
                    {
                        "asynchronous": false,
                        "doc": "",
                        "end_class_code": "def process_empty_or_invalid(self, request, queryset):\n    return queryset.filter(date__gte = year_ago())\n",
                        "end_code": "",
                        "module": null,
                        "name": "_FilterFormReport",
                        "process_code": "date_from = self.cleaned_data['date_from']\ndate_to = self.cleaned_data['date_to']\n\nif date_from:\n    queryset = queryset.filter(date__gte = date_from)\nif date_to:\n    queryset = queryset.filter(date__lte = date_to)\nreturn queryset\n"
                    },
                    [
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": "year_ago",
                            "label": "Data od",
                            "name": "date_from",
                            "param": null,
                            "required": false,
                            "type": "DateField",
                            "widget": null
                        },
                        {
                            "error_messages": null,
                            "help_text": null,
                            "initial": null,
                            "label": "Data do",
                            "name": "date_to",
                            "param": null,
                            "required": true,
                            "type": "DateField",
                            "widget": null
                        }
                    ]
                ]
            ],
            [],
            [],
            [
                {
                    "content": "from base64 import b64encode\nimport io\nimport re\nimport itertools\nimport html\n\nfrom django import template\nfrom django.utils.translation import gettext_lazy as _\nfrom django.template.loader import get_template\nfrom django.template import Context, Template, RequestContext\nfrom django.conf import settings\nfrom django.utils.safestring import mark_safe\nfrom django.forms.widgets import CheckboxSelectMultiple\nfrom django.template.base import token_kwargs, TemplateSyntaxError\nfrom django.template.base import Node\n\nfrom pytigon_lib.schhtml.parser import Parser\nfrom pytigon_lib.schtools.wiki import wiki_from_str\nfrom pytigon_lib.schdjangoext.tools import make_href\n\nregister = template.Library()\n\ndef inclusion_tag(file_name):\n    def dec(func):\n        def func2(context, *argi, **argv):\n            ret = func(context, *argi, **argv)\n            t = get_template(file_name)\n            return t.render(ret, context.request)\n        return register.simple_tag(takes_context=True, name=getattr(func, '_decorated_function', func).__name__)(func2)\n    return dec\n\n@inclusion_tag('schreports/subreport.html')\ndef subrep(context, name, type):\n    rep = context['rep']\n    rep_def = context['rep_def']\n    url = make_href(\"/schreports/edit_subrep/%d/%s/%s/\" % (rep.id, name, type))\n    return { 'href':  url }\n\n@inclusion_tag('schreports/check.html')\ndef check(context, is_checked, title=\"\"):\n    return { 'is_checked':  is_checked, 'title': title }\n",
                    "file_type": "t",
                    "name": "subreport"
                }
            ]
        ],
        [
            {
                "consumer_code": "",
                "doc": null,
                "icon": "png://apps/preferences-desktop-theme.png",
                "icon_code": null,
                "icon_size": "1",
                "index": null,
                "jsondata": null,
                "model_code": "from django.contrib.auth import get_user_model\nfrom django.db.models.signals import post_save, pre_delete\nfrom django.dispatch import receiver\nfrom schelements.models import Element \nfrom django.contrib import admin\nfrom django.contrib.auth.admin import UserAdmin as BaseUserAdmin\nfrom pytigon_lib.schtools.tools import get_request\n\ndef limit_owner():\n    return {}\n    \ndef limit_config():\n    return {}\n        \nLIMIT_OWNER = OverwritableCallable(limit_owner)\nLIMIT_CONFIG = OverwritableCallable(limit_config)\n\ndef set_active_variant(user, value):\n    pass\n\ndef get_active_variant(user):\n    return None\n\ndef get_active_variant_description(user):\n    return None\n\ndef get_all_variants(user):\n    return []\n\nSET_ACTIVE_VARIANT = OverwritableCallable(set_active_variant)\nGET_ACTIVE_VARIANT = OverwritableCallable(get_active_variant)\nGET_ACTIVE_VARIANT_DESCRIPTION = OverwritableCallable(get_active_variant_description)\nGET_ALL_VARIANTS = OverwritableCallable(get_all_variants)\n\n$$$\n\nUSER_PROFILES = False\n\ndef init_user_profiles():\n    global USER_PROFILES\n\n    if not USER_PROFILES:\n        USER_PROFILES = True\n\n        @receiver(post_save, sender=get_user_model())\n        def create_user_profile(sender, instance, created, **kwargs):\n            if created:\n                Profile.objects.create(user=instance)\n\n            if hasattr(instance, \"profile\"):\n                instance.profile.save()\n            else:\n                if not created:\n                    Profile.objects.create(user=instance)\n\n        class UserWithProfileInline(admin.StackedInline):\n            model = Profile\n            can_delete = False\n            verbose_name_plural = \"Profile\"\n\n        class UserAdmin(BaseUserAdmin):\n            inlines = (UserWithProfileInline,)\n\n            def get_inline_instances(self, request, obj=None):\n                if not obj:\n                    return list()\n                return super(UserAdmin, self).get_inline_instances(request, obj)\n\n        admin.site.unregister(get_user_model())\n        admin.site.register(get_user_model(), UserAdmin)\n",
                "module_title": "Data structures",
                "name": "schprofile",
                "perms": true,
                "tasks_code": "",
                "title": "Profile",
                "urls_code": null,
                "user_param": "",
                "view_code": null
            },
            [
                [
                    {
                        "base_table": null,
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_profile\", \"Can administer profiles\"),\n]\n",
                        "name": "Profile",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "user = models.OneToOneField(get_user_model(), on_delete=models.CASCADE)\n\ndef set_active_variant(self, value):\n    request = get_request()\n    session[\"active_variant\"] = value\n    if request and request.user:\n        return SET_ACTIVE_VARIANT(request.user, value)\n    else:\n        return None\n\ndef get_active_variant(self):\n    request = get_request()\n    ret = session.get(\"active_variant\", None)\n    if ret != None:\n        return ret\n    else:\n        if request and request.user:\n            return GET_ACTIVE_VARIANT(request.user)\n        else:\n            return None\n\ndef get_active_variant_description(self):\n    request = get_request()\n    if request and request.user:\n        return GET_ACTIVE_VARIANT_DESCRIPTION(request.user)\n    else:\n        return None\n\ndef get_all_variants(self):\n    request = get_request()\n    if request and request.user:\n        return GET_ALL_VARIANTS(request.user)\n    else:\n        return None\n",
                        "url_params": null,
                        "verbose_name": "Profile",
                        "verbose_name_plural": "Profiles"
                    },
                    [
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Owner",
                            "editable": true,
                            "help_text": null,
                            "name": "owner",
                            "null": true,
                            "param": "related_name=\"profile_owners\", limit_choices_to=LIMIT_OWNER",
                            "rel_to": "schelements.Element",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Config",
                            "editable": true,
                            "help_text": null,
                            "name": "config",
                            "null": true,
                            "param": "related_name=\"profile_configs\",limit_choices_to=LIMIT_CONFIG",
                            "rel_to": "schelements.Element",
                            "type": "PtigForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "User type",
                            "editable": true,
                            "help_text": null,
                            "name": "user_type",
                            "null": true,
                            "param": "max_length=32",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Allowed document registers",
                            "editable": true,
                            "help_text": null,
                            "name": "doc_regs",
                            "null": true,
                            "param": "max_length=256",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Allowed document types",
                            "editable": true,
                            "help_text": null,
                            "name": "doc_types",
                            "null": true,
                            "param": "max_length=256",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Allowed accounts",
                            "editable": true,
                            "help_text": null,
                            "name": "accounts",
                            "null": true,
                            "param": "max_length=256",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Aliases",
                            "editable": true,
                            "help_text": null,
                            "name": "aliases",
                            "null": true,
                            "param": "max_length=256",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ]
            ],
            [],
            [],
            [
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "Profile",
                    "tags_mount": null,
                    "template_code": "% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% all\n    % with table_type='datatable':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"<<new_row_title>>\"\n    % list_action \"<<action>>\" \"<<action_description>>\"\n\n%% list_row_header\n    th..._(Owner)\n    th..._(Config)\n    th..._(User type)\n    th..._(Allowed document registers)\n    th..._(Allowed document types)\n    th..._(Allowed accounts)\n    \n\n%% list_row\n    td...{{ object.owner }}\n    td...{{ object.config }}\n    td...{{ object.user_type }}\n    td...{{ object.doc_regs }}\n    td...{{ object.doc_types }}\n    td...{{ object.accounts }}\n    \n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .delete\n        .<<action_name>>,<<description>>\n\n%% row_edit\n    % form:\n        .owner,config,user_type,doc_regs,doc_types,accounts\n",
                    "url": null,
                    "url_parm": null
                }
            ],
            [],
            [],
            [],
            [],
            []
        ],
        [
            {
                "consumer_code": "",
                "doc": null,
                "icon": "None",
                "icon_code": null,
                "icon_size": "1",
                "index": null,
                "jsondata": null,
                "model_code": "from pytigon_lib.schtools.schjson import json_dumps, json_loads\nfrom django.db.models import Max, Min\n\nfrom schelements.models import *",
                "module_title": "Data structures",
                "name": "schstruct",
                "perms": true,
                "tasks_code": "",
                "title": "Structures",
                "urls_code": null,
                "user_param": "",
                "view_code": "from pytigon_lib.schtools.schjson import json_dumps, json_loads\nfrom pytigon_lib.schdjangoext.django_ihtml import ihtml_to_html\nfrom pytigon_lib.schdjangoext.fastform import form_from_str\nfrom pytigon_lib.schviews import make_path\nfrom schelements.models import DocReg, DocType, DocHead, Element\nfrom django.db.models import F\nfrom schelements.views import year_ago\n\ndef move_rep(request, id, to_pos = \"+1\"):\n    obj = models.Report.objects.get(pk=id)\n    url = make_path('ok')\n    if not obj.parent:\n        return HttpResponseRedirect(url)\n    \n    if type(to_pos)==str:\n        if to_pos==\"+1\":\n            objects = models.Report.objects.filter(parent = obj.parent).filter(order__gt = obj.order)\n            if len(objects)>0:\n                obj2 = objects[0]\n            else: \n                return HttpResponseRedirect(url)\n        elif to_pos=='-1':    \n            objects = models.Report.objects.filter(parent = obj.parent).filter(order__lt = obj.order)\n            if len(objects)>0:\n                obj2 = list(objects)[-1]\n            else: \n                return HttpResponseRedirect(url)\n                \n        tmp_order = obj.order\n        obj.order = obj2.order\n        obj2.order = tmp_order\n        obj.save()\n        obj2.save()\n        \n    elif type(to_pos)==int:\n        obj2 = models.Report.objects.get(pk=to_pos)\n        order = obj2.order\n        if obj.order < order:\n            objects = models.Report.objects.filter(parent = obj.parent).filter(order__gt = obj2.order).update(order=F('order')+2)\n            obj.order = order+1\n        else:\n            objects = models.Report.objects.filter(parent = obj.parent).filter(order__gte = obj2.order).update(order=F('order')+2)\n            obj.order = order\n        obj.save()\n\n    return actions.refresh(request)\n"
            },
            [
                [
                    {
                        "base_table": "schelements.BaseObject",
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_commongroupdef\", \"Can administer common group definitions\"),\n]\n",
                        "name": "CommonGroupDef",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def __str__(self):\n    return self.name",
                        "url_params": null,
                        "verbose_name": "Common group definition",
                        "verbose_name_plural": "Common groups definition"
                    },
                    [
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "On new elemetn event",
                            "editable": false,
                            "help_text": null,
                            "name": "on_new_elem_event",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Allowed new fields",
                            "editable": false,
                            "help_text": null,
                            "name": "allowed_new_fields",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "TextField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Main group",
                            "editable": true,
                            "help_text": null,
                            "name": "main_group",
                            "null": true,
                            "param": null,
                            "rel_to": null,
                            "type": "NullBooleanField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ],
                [
                    {
                        "base_table": "JSONModel",
                        "doc": null,
                        "generic": true,
                        "metaclass_code": "permissions = [\n    (\"admin_commongroup\", \"Can administer common groups\"),\n]\n",
                        "name": "CommonGroup",
                        "ordering": "['id']",
                        "proxy_model": null,
                        "table_code": "def code(self):\n    return self.title\n\ndef get_def(self):\n    x = CommonGroupDef.objects.filter(name=self.group_def_name)\n    if len(x)>0:\n        return x[0]\n    else:\n        return None\n\ndef to_str(self):\n    def_obj = self.get_def()\n    if def_obj:\n        return def_obj.to_str(self)\n    else:\n        return None\n\ndef __str__(self): \n    return f\"{self.title} [{self.group_def_name}]\"\n\n@staticmethod    \ndef get_group_types(parent_pk):\n    if not parent_pk:\n        groupdef_list = CommonGroupDef.objects.filter(main_group=True)\n        return [pos for pos in groupdef_list]\n    else:\n        group = CommonGroup.objects.get(id=int(parent_pk))        \n        groupdef = CommonGroupDef.objects.filter(name=group.group_def_name)\n        ret = []\n        if len(groupdef)>0:\n            allowed_new_fields = groupdef[0].allowed_new_fields\n            if allowed_new_fields:                    \n                for pos in allowed_new_fields.replace(',',';').split(';'):\n                    if pos:\n                        objs = CommonGroupDef.objects.filter(name=pos)\n                        if len(objs)>0:\n                            ret.append(objs[0])\n        return ret\n\n",
                        "url_params": null,
                        "verbose_name": "Common group",
                        "verbose_name_plural": "Common groups"
                    },
                    [
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Parent",
                            "editable": true,
                            "help_text": null,
                            "name": "parent",
                            "null": true,
                            "param": null,
                            "rel_to": "'self'",
                            "type": "PtigTreeForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Grand parent",
                            "editable": true,
                            "help_text": null,
                            "name": "gparent",
                            "null": true,
                            "param": "related_name='gparentrel'",
                            "rel_to": "'self'",
                            "type": "ForeignKey",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Title",
                            "editable": true,
                            "help_text": null,
                            "name": "title",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Group definition name",
                            "editable": true,
                            "help_text": null,
                            "name": "group_def_name",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": false,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Grand parent group definition name",
                            "editable": true,
                            "help_text": null,
                            "name": "gp_group_def_name",
                            "null": false,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": false,
                            "default": null,
                            "description": "Tag name",
                            "editable": true,
                            "help_text": null,
                            "name": "tag_name",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Key 1",
                            "editable": true,
                            "help_text": null,
                            "name": "key1",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Key 2",
                            "editable": true,
                            "help_text": null,
                            "name": "key2",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        },
                        {
                            "blank": true,
                            "choices": null,
                            "db_index": true,
                            "default": null,
                            "description": "Key 3",
                            "editable": true,
                            "help_text": null,
                            "name": "key3",
                            "null": true,
                            "param": "max_length=64",
                            "rel_to": null,
                            "type": "CharField",
                            "unique": false,
                            "url_params": null
                        }
                    ]
                ]
            ],
            [],
            [
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "new_group",
                    "param": "group_type, parent_id",
                    "ret_type": "U",
                    "url": "new_group/(?P<group_type>\\w+)/(?P<parent_id>\\d+)/$",
                    "url_params": "{}",
                    "view_code": "#new_group/(?P<group_type>\\w+)/(?P<parent_id\\d+)/$\nif parent_id and int(parent_id)>0:\n    parent = models.CommonGroup.objects.get(id=int(parent_id))\nelse:\n    parent = None\ngroup = models.CommonGroup()\nif parent:\n    group.parent = parent\n    gparent  = parent\n    while gparent.parent:\n        gparent = gparent.parent\n    group.gparent =gparent\n    group.gp_group_def_name = gparent.group_def_name    \nelse:\n    group.gp_group_def_name = group_type\n    \ngroup.group_def_name = group_type\ngroup.save()\n\nif not group.gparent:\n    group.gparent = group\n    group.save()\n    \nurl = make_href(\"/schstruct/table/CommonGroup/%d/edit__group/\" % group.id)\nreturn HttpResponseRedirect(url)\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "edit__group",
                    "param": "group_id",
                    "ret_type": "U",
                    "url": "table/CommonGroup/(?P<group_id>\\d+)/edit__group/$",
                    "url_params": "{}",
                    "view_code": "group = models.CommonGroup.objects.get(pk=group_id)\ngroup_def = models.CommonGroupDef.objects.get(name=group.group_def_name)\n\nif group_def.declaration:\n    form_class = form_from_str(group_def.declaration)\nelse:\n    return HttpResponse(\"ERROR\")\n    \nif request.POST or request.FILES:    \n    if request.method == 'POST':\n        form = form_class(request.POST, request.FILES)\n        if form.is_valid():\n            if group_def.save_fun:\n                exec(group_def.save_fun)\n                data = locals()['save'](form, group)\n            else:\n                data = form.cleaned_data\n            \n            if not data:\n                data = {}\n            \n            if 'title' in data:\n                group.title = data['title']\n                del data['title']\n            group.jsondata = data\n            #group._data = data\n            #group._data['json_update'] = True\n            group.save()\n            url = make_path('ok')\n            return HttpResponseRedirect(url)\n    \nif not request.POST:\n    data = group.get_json_data()\n    \n    if group_def.load_fun:\n        exec(group_def.load_fun)\n        data_form = locals()['load'](data)\n    else:\n        data_form = data\n\n    if not data:\n        data = {}\n\n    data_form['title'] = group.title\n    form = form_class(initial=data_form)\n\nt = Template(ihtml_to_html(None, group_def.template))\nc = RequestContext(request, { 'form': form, 'group': group, 'group_def': group_def})\n\nreturn HttpResponse(t.render(c))\n",
                    "view_type": "u"
                },
                {
                    "asynchronous": false,
                    "doc": null,
                    "extra_code": null,
                    "name": "list_group_by_tag",
                    "param": "group_tag",
                    "ret_type": "U",
                    "url": "list_group_by_tag/(?P<group_tag>\\w+)/$",
                    "url_params": "{}",
                    "view_code": "groups = models.CommonGroup.objects.filter(tag_name=group_tag)\nif len(groups)>0:\n    group = groups[0]\n    url = make_href(\"/schstruct/table/CommonGroup/%d/%d/form/tree/?only_content=1\" % (group.id, group.id))\nelse:\n    url = make_href(\"/schstruct/table/CommonGroup/0/form/tree/?only_content=1\")\nreturn HttpResponseRedirect(url)    \n",
                    "view_type": "u"
                }
            ],
            [
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "CommonGroup",
                    "tags_mount": null,
                    "template_code": "% extends \"forms/tree.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with form_width=800 form_height=600 table_type='simple' title=_(\"Common Groups\"):\n        {{ block.super }}\n\n%% list_content_actions_new_row\n    div class=tr d-inline\n        % with object_list.model|args:parent_pk|call:\"get_group_types\" as tab:\n            % if tab:\n                ._(New): \n                % for pos in tab:\n                    % new_row_inline pos.description \"\" \"\" \"\" \"\" table_path|append_str:\"../../new_group/\"|append_str:pos.name|append_str:\"/\"|append_str:parent_pk|append_str:\"/\"\n\n%% list_row_header\n    th...Title\n\n%% list_row\n    td...{{object.to_str|safe }}\n        \n%% list_row_actions\n    % if object.get_def.action_template:\n        {% subtemplate object.get_def.get_action_template %}\n    % else:\n        % row_actions:\n            .edit-inline,_(Update),,,,,{{base_path}}schstruct/table/CommonGroup/{id}/edit__group/\n            .pdf\n            .odf        \n            .field_edit/data,Data,data        \n            .delete\n\n%% row_edit\n    % form:\n        \n",
                    "url": null,
                    "url_parm": null
                },
                {
                    "asynchronous": false,
                    "direct_to_template": null,
                    "name": "CommonGroupDef",
                    "tags_mount": null,
                    "template_code": "% extends \"forms/form.html\"\n\n% load exfiltry\n% load exsyntax\n\n%% pythoncode\n    script language=python\n        def signal_from_child(self, child, signal):\n            if signal=='set_bitmap_list':\n                bitmaps = {\n                }\n                child.set_bitmaps(bitmaps)\n\n        def filter_url(self, target, href):\n            return href\n\n%% all\n    %with table_type='datatable':\n        {{ block.super }}\n\n%% scroll\n\n%% list_content_actions\n    % new_row \"New group definition\"\n\n%% list_row_header\n    th...Name\n    th...Description\n    th...Main group\n\n%% list_row\n    td...{{object.name}}\n    td...{{object.description}}\n    td...{{object.main_group}}\n\n%% list_row_actions\n    % row_actions:\n        .edit\n        .field_edit/declaration,Declaration,declaration\n        .field_edit/template,Template,template\n        .field_edit/to_html_rec,To html row,to_html_rec\n        .field_edit/save_fun,Save function,save_fun\n        .field_edit/load_fun,Load function,load_fun\n        .field_edit/on_new_elem_event,On new element,on_new_elem_event\n        .field_edit/allowed_new_fields,Allowed new fields,allowed_new_fields\n        .field_edit/to_str_fun,Convert to string function,to_str_fun\n        .field_edit/action_template,Action template,action_template\n        .delete\n\n%% row_edit\n    % form:\n        .app,name,description,main_group\n\n",
                    "url": null,
                    "url_parm": null
                }
            ],
            [
                {
                    "icon": "png://apps/system-file-manager.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Common group definitons",
                    "perms": "schreports.admin_commongroupdef",
                    "url": "table/CommonGroupDef/-/form/list/",
                    "url_type": "desktop"
                },
                {
                    "icon": "png://apps/system-file-manager.png",
                    "icon_code": null,
                    "icon_size": "1",
                    "name": "Common groups",
                    "perms": "schreports.admin_commongroup",
                    "url": "table/CommonGroup/0/form/tree/",
                    "url_type": "desktop"
                }
            ],
            [],
            [],
            [],
            []
        ]
    ],
    [
        {
            "code": "def subreport_dragstart(ev):\n    ev.dataTransfer.setData(\"text\", ev.target.getAttribute(\"name\"))                        \n\nwindow.subreport_dragstart = subreport_dragstart\n\ndef subreport_drop(ev, base_path):\n    ev.preventDefault()\n    if ev.target.tagName == 'LABEL':\n        target=ev.target\n    else:\n        target=ev.target.parentElement\n    \n    data = ev.dataTransfer.getData(\"text\")\n    data2 = target.getAttribute(\"name\")\n    if data2 != data:\n        href = base_path + 'schreports/table/Report/'+data+'/'+data2+'/action/move_to/'\n        def _callback(data):\n            window.refresh_ajax_frame(target)\n        window.ajax_get(href,_callback)\n        #ajax_get(href,standard_on_data(jQuery(target), href))\n\nwindow.subreport_drop = subreport_drop\n\ndef subreport_ondragenter(ev):\n    if ev.target.tagName == 'LABEL':\n        jQuery(ev.target).addClass('bg-success')\n\nwindow.subreport_ondragenter = subreport_ondragenter\n\ndef subreport_ondragleave(ev):\n    if ev.target.tagName == 'LABEL':\n        jQuery(ev.target).removeClass('bg-success')\n\nwindow.subreport_ondragleave = subreport_ondragleave\n\ndef subreport_ondragover(ev):\n    if ev.target.tagName == 'LABEL':\n        ev.preventDefault()\n    \nwindow.subreport_ondragover = subreport_ondragover\n",
            "doc": null,
            "name": "subreport",
            "type": "P"
        }
    ]
]