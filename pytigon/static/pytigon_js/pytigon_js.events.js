'use strict';import{AssertionError,AttributeError,BaseException,DeprecationWarning,Exception,IndexError,IterableError,KeyError,NotImplementedError,RuntimeWarning,StopIteration,UserWarning,ValueError,Warning,__JsIterator__,__PyIterator__,__Terminal__,__add__,__and__,__call__,__class__,__envir__,__eq__,__floordiv__,__ge__,__get__,__getcm__,__getitem__,__getslice__,__getsm__,__gt__,__i__,__iadd__,__iand__,__idiv__,__ijsmod__,__ilshift__,__imatmul__,__imod__,__imul__,__in__,__init__,__ior__,__ipow__,
__irshift__,__isub__,__ixor__,__jsUsePyNext__,__jsmod__,__k__,__kwargtrans__,__le__,__lshift__,__lt__,__matmul__,__mergefields__,__mergekwargtrans__,__mod__,__mul__,__ne__,__neg__,__nest__,__or__,__pow__,__pragma__,__proxy__,__pyUseJsNext__,__rshift__,__setitem__,__setproperty__,__setslice__,__sort__,__specialattrib__,__sub__,__super__,__t__,__terminal__,__truediv__,__withblock__,__xor__,abs,all,any,assert,bool,bytearray,bytes,callable,chr,copy,deepcopy,delattr,dict,dir,divmod,enumerate,filter,float,
getattr,hasattr,input,int,isinstance,issubclass,len,list,map,max,min,object,ord,pow,print,property,py_TypeError,py_iter,py_metatype,py_next,py_reversed,py_typeof,range,repr,round,set,setattr,sorted,str,sum,tuple,zip}from"./org.transcrypt.__runtime__.js";import{get_ajax_region,mount_html,refresh_ajax_frame}from"./pytigon_js.ajax_region.js";import{Loading,ajax_get,can_popup,corect_href,get_elem_from_string,get_template,is_visible,process_resize,remove_element,super_insert}from"./pytigon_js.tools.js";
import{get_menu}from"./pytigon_js.tabmenu.js";var __name__="pytigon_js.events";export var EVENT_TAB=[];export var REGISTERED_EVENT_TYPES=[];export var _chcek_element=function(element,py_selector){if(!py_selector)return true;if(__in__(".",py_selector)){var x=py_selector.py_split(".");var tag=x[0];var sel=x[1]}else if(py_selector.startswith("#")){var tag=null;var sel=py_selector}else{var tag=py_selector;var sel=null}if(tag)if(!(element.tagName.lower()==tag))return false;if(sel)if(sel.startswith("#")){if(element.id!=
sel.__getslice__(1,null,1))return false}else if(!element.classList.contains(sel))return false;return true};export var _get_title=function(element,data_element,url){var title=element.getAttribute("title");if(data_element){var title_element=data_element.querySelector("title");if(title_element)var title_alt=title_element.innerHTML.strip();else var title_alt=""}else var title_alt="";if(!title&&!title_alt){var url2=url.py_split("?")[0];if(len(url2)>16)var title="..."+url2.__getslice__(-13,null,1);else var title=
url2}else if(!title){var title=title_alt;var title_alt=""}return tuple([title,title_alt])};export var on_global_event=function(event){for(var pos of EVENT_TAB)if(pos[0]==event.type){var element=event.target;while(element){if(_chcek_element(element,pos[2]))return pos[1](event,element);var element=element.parentElement;if(element&&element.tagName.lower()=="body")break}}};export var register_global_event=function(event_type,fun,py_selector){if(!__in__(event_type,REGISTERED_EVENT_TYPES)){document.body.addEventListener(event_type,
on_global_event);REGISTERED_EVENT_TYPES.append(event_type)}EVENT_TAB.append(tuple([event_type,fun,py_selector]))};window.register_global_event=register_global_event;export var _get_value=function(elem,py_name){if(elem.length>0){var x=elem.closest(".ajax-region");if(x.length>0){var x2=x.find(sprintf("[name='%s']",py_name));if(x2.length>0)return x2.val()}}return"[[ERROR]]"};export var process_href=function(href,elem){var ret=[];if(__in__("[[",href)&&__in__("]]",href)){var x1=href.py_split("[[");var process=
false;for(var pos of x1)if(process){if(__in__("]]",pos)){var x2=pos.py_split("]]",1);var value=_get_value(elem,x2[0]);if(value&&value!="None")ret.append(value+x2[1]);else ret.append(x2[1])}else ret.append(pos);var process=false}else{ret.append(pos);var process=true}return"".join(ret)}else return href};window.process_href=process_href;export var _get_click_event_from_tab=function(target_element,target,href){for(var pos of EVENT_CLICK_TAB)if(pos[0]=="*"||pos[0]==target)if(pos[1]=="*"||target_element.classList.contains(pos[1])){if(pos[3])var url=
corect_href(href,true);else if(pos[2])var url=corect_href(href,false);else var url=href;return tuple([url,pos[4]])}return tuple([null,null])};export var on_click_default_action=function(event,target_element){var target=target_element.getAttribute("target");if(window.APPLICATION_TEMPLATE=="traditional")if(!target||target&&__in__(target,tuple(["_self","_parent","_top"])))return false;var src_obj=jQuery(target_element);var href=target_element.getAttribute("xlink:href");if(!href)var href=target_element.getAttribute("href");
if(!href)var href=target_element.getAttribute("action");if(!href)var href=target_element.getAttribute("src");if(href&&__in__("#",href))return true;if(src_obj.hasClass("editable"))return true;if(href)var href=process_href(href,jQuery(target_element));if(target_element.tagName.lower()=="form"){if(target_element.getAttribute("target")=="_blank"){target_element.setAttribute("enctype","multipart/form-data");target_element.setAttribute("encoding","multipart/form-data");return true}if(target_element.getAttribute("target")==
"_self")return true;if(target_element.querySelector("[type='file']"))var param="file";else var param=jQuery(target_element).serialize();if(param&&__in__("pdf=on",param)){target_element.setAttribute("enctype","multipart/form-data");target_element.setAttribute("encoding","multipart/form-data");return true}if(target_element&&__in__("odf=on",param)){target_element.setAttribute("enctype","multipart/form-data");target_element.setAttribute("encoding","multipart/form-data");return true}}else{var param=null;
if(target=="_blank")return}var _get_or_post=function(url,callback,data2){if(typeof data2=="undefined"||data2!=null&&data2.hasOwnProperty("__kwargtrans__"))var data2=null;var loading=Loading(target_element);loading.create();loading.start();var _callback=function(data){loading.stop();loading.remove();var data_element=get_elem_from_string(data);var new_target_elem=data_element.querySelector("meta[name='target']");if(new_target_elem)var new_target=new_target_elem.getAttribute("content");else var new_target=
null;if(new_target&&new_target!=target){var __left0__=_get_click_event_from_tab(target_element,new_target,url);var new_callback=__left0__[0];var new_url=__left0__[1];new_callback(target_element,data_element,new_url,param,event)}else callback(target_element,data_element,url,param,event)};if(url)if(param)ajax_post(url,param,_callback);else ajax_get(url,_callback);else _callback(data2)};var __left0__=_get_click_event_from_tab(target_element,target,href);var url=__left0__[0];var callback=__left0__[1];
if(callback){if(param=="file"){var _callback2=function(data2){_get_or_post(null,callback,data2)};ajax_submit(target_element,_callback2,null,null)}else if(url)_get_or_post(url,callback,null);else callback(target_element,null,null,null,event);event.preventDefault();return true}};export var _on_menu_click=function(event,target_element){if(window.APPLICATION_TEMPLATE!="traditional"){event.preventDefault();var toggler=document.querySelector("#topmenu .navbar-toggler");if(toggler&&is_visible(toggler)){var _on_collapse=
function(){on_click_default_action(event,target_element);jQuery("#navbar-ex1-collapse").off("hidden.bs.collapse",_on_collapse)};jQuery("#navbar-ex1-collapse").on("hidden.bs.collapse",_on_collapse);jQuery("#navbar-ex1-collapse").collapse("hide")}else on_click_default_action(event,target_element)}};register_global_event("click",_on_menu_click,"a.menu-href");register_global_event("click",on_click_default_action,"a");register_global_event("click",on_click_default_action,"button");register_global_event("submit",
on_click_default_action,"form");export var _on_inline=function(target_element,data_element,url,param,event,template_name){var inline_position=target_element.getAttribute("data-inline-position");if(inline_position&&inline_position.py_split(":")[0].endswith("tr")){var dialog_slot=document.createElement("tr");var child=document.createElement("td");child.setAttribute("colspan","100");dialog_slot.appendChild(child);var dialog_slot2=child}else{var dialog_slot=document.createElement("div");dialog_slot.classList.add("col-12");
var dialog_slot2=dialog_slot}dialog_slot.classList.add("plug");dialog_slot2.innerHTML=get_template(template_name.py_replace("MODAL","INLINE"),dict({"title":_get_title(target_element,data_element,url)[0]}));target_element.setAttribute("data-style","zoom-out");target_element.setAttribute("data-spinner-color","#FF0000");var content=dialog_slot.querySelector("div.dialog-data");content.appendChild(data_element);super_insert(target_element,inline_position,dialog_slot);mount_html(dialog_slot,null);var on_hidden=
function(event){var region=get_ajax_region(target_element,target_element.getAttribute("data-region"));if(region){var obj=region.querySelector(".plug");obj.remove()}};var dialog=jQuery(dialog_slot.firstElementChild);if(dialog)dialog.on("click","button.btn-close",on_hidden)};export var on_inline=function(target_element,data_element,new_url,param,event){return _on_inline(target_element,data_element,new_url,param,event,"INLINE")};export var on_inline_edit_new=function(target_element,data_element,new_url,
param,event){return _on_inline(target_element,data_element,new_url,param,event,"INLINE_EDIT")};export var on_inline_info=function(target_element,data_element,new_url,param,event){return _on_inline(target_element,data_element,new_url,param,event,"INLINE_INFO")};export var on_inline_delete=function(target_element,data_element,new_url,param,event){return _on_inline(target_element,data_element,new_url,param,event,"INLINE_DELETE")};export var on_inline_error=function(target_element,data_element,new_url,
param,event){return _on_inline(target_element,data_element,new_url,param,event,"INLINE_ERROR")};export var _on_popup=function(target_element,data_element,url,param,event,template_name){if(!can_popup())return _on_inline(target_element,data_element,url,param,event,template_name);var dialog_slot=document.createElement("aside");dialog_slot.setAttribute("class","plug");dialog_slot.innerHTML=get_template(template_name,dict({"title":_get_title(target_element,data_element,url)[0]}));var region=get_ajax_region(target_element,
target_element.getAttribute("data-region"));if(!region)return;region.appendChild(dialog_slot);target_element.setAttribute("data-style","zoom-out");target_element.setAttribute("data-spinner-color","#FF0000");var content=dialog_slot.querySelector("div.dialog-data");mount_html(content,data_element);var on_hidden=function(event){var obj=region.querySelector(".plug");if(obj)obj.remove()};var dialog=jQuery(dialog_slot.firstElementChild);if(dialog){dialog.on("hidden.bs.modal",on_hidden);dialog.drags(dict({"handle":".modal-header"}));
dialog.modal(dict({"show":true}))}};export var on_popup=function(target_element,data_element,new_url,param,event){return _on_popup(target_element,data_element,new_url,param,event,"MODAL")};export var on_popup_edit_new=function(target_element,data_element,new_url,param,event){return _on_popup(target_element,data_element,new_url,param,event,"MODAL_EDIT")};export var on_popup_info=function(target_element,data_element,new_url,param,event){return _on_popup(target_element,data_element,new_url,param,event,
"MODAL_INFO")};export var on_popup_delete=function(target_element,data_element,new_url,param,event){return _on_popup(target_element,data_element,new_url,param,event,"MODAL_DELETE")};export var on_popup_error=function(target_element,data_element,new_url,param,event){return _on_popup(target_element,data_element,new_url,param,event,"MODAL_ERROR")};export var on_new_tab=function(target_element,data_element,new_url,param,event){var __left0__=_get_title(target_element,data_element,new_url);var title=__left0__[0];
var title_alt=__left0__[1];var data_element2=data_element.querySelector("section.body-body");if(!data_element2)var data_element2=data_element;return get_menu().on_menu_href(target_element,data_element2,title,title_alt,new_url)};export var on_replace_app=function(target_element,data_element,new_url,param,event){if(window.PUSH_STATE)history_push_state("",window.BASE_PATH);else window.location.pathname=window.BASE_PATH;window.MENU=null;mount_html(document.querySelector("section.body-body"),data_element.querySelector("section.body-body"),
false)};export var refresh_frame=function(target_element,data_element,new_url,param,event){var dialog=null;var aside=target_element.closest(".plug");if(aside)var dialog=aside.firstElementChild;var _callback=function(){if(aside)if(dialog&&dialog.classList.contains("modal"))jQuery(dialog).modal("hide");else aside.remove()};var _callback_on_error=function(){if(aside)aside.style.opacity="100%"};if(aside)aside.style.opacity="50%";var f=target_element.getAttribute("data-remote-elem");if(f)var data_element2=
data_element.querySelector(f);else var data_element2=data_element;var data_region=target_element.getAttribute("data-region");refresh_ajax_frame(target_element,data_region,data_element2,_callback,_callback_on_error)};export var refresh_page=function(target_element,data_element,new_url,param,event){var frame=target_element.closest("div.content");if(frame&&frame.firstElementChild){if(py_typeof(data_element)==str)var data_element2=null;else var data_element2=data_element.querySelector("div.content");
if(data_element2)if(data_element2.firstElementChild)var data_element2=data_element2.firstElementChild;if(!data_element2)var data_element2=data_element;mount_html(frame,data_element2)}};export var refresh_app=function(target_element,data_element,new_url,param,event){window.location.href=window.BASE_PATH};export var only_get=function(target_element,data_element,url,param,event){};export var EVENT_CLICK_TAB=[tuple(["inline","*",true,false,on_inline]),tuple(["inline_edit","*",true,false,on_inline_edit_new]),
tuple(["inline_info","*",true,false,on_inline_info]),tuple(["inline_delete","*",true,false,on_inline_delete]),tuple(["inline_error","*",true,false,on_inline_error]),tuple(["popup","*",true,false,on_popup]),tuple(["popup_edit","*",true,false,on_popup_edit_new]),tuple(["popup_info","*",true,false,on_popup_info]),tuple(["popup_delete","*",true,false,on_popup_delete]),tuple(["popup_error","*",true,false,on_popup_error]),tuple(["_top","*",false,false,on_replace_app]),tuple(["_top2","*",true,false,on_new_tab]),
tuple(["_self","*",true,false,refresh_page]),tuple(["_parent","*",true,false,on_new_tab]),tuple(["refresh_frame","*",true,false,refresh_frame]),tuple(["refresh_page","*",true,false,refresh_page]),tuple(["refresh_app","*",false,false,refresh_app]),tuple(["null","*",false,false,only_get])];export var on_resize=function(event){process_resize(document.body)};window.addEventListener("resize",on_resize);

//# sourceMappingURL=pytigon_js.events.map