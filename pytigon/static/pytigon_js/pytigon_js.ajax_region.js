'use strict';import{AssertionError,AttributeError,BaseException,DeprecationWarning,Exception,IndexError,IterableError,KeyError,NotImplementedError,RuntimeWarning,StopIteration,UserWarning,ValueError,Warning,__JsIterator__,__PyIterator__,__Terminal__,__add__,__and__,__call__,__class__,__envir__,__eq__,__floordiv__,__ge__,__get__,__getcm__,__getitem__,__getslice__,__getsm__,__gt__,__i__,__iadd__,__iand__,__idiv__,__ijsmod__,__ilshift__,__imatmul__,__imod__,__imul__,__in__,__init__,__ior__,__ipow__,
__irshift__,__isub__,__ixor__,__jsUsePyNext__,__jsmod__,__k__,__kwargtrans__,__le__,__lshift__,__lt__,__matmul__,__mergefields__,__mergekwargtrans__,__mod__,__mul__,__ne__,__neg__,__nest__,__or__,__pow__,__pragma__,__proxy__,__pyUseJsNext__,__rshift__,__setitem__,__setproperty__,__setslice__,__sort__,__specialattrib__,__sub__,__super__,__t__,__terminal__,__truediv__,__withblock__,__xor__,abs,all,any,assert,bool,bytearray,bytes,callable,chr,copy,deepcopy,delattr,dict,dir,divmod,enumerate,filter,float,
getattr,hasattr,input,int,isinstance,issubclass,len,list,map,max,min,object,ord,pow,print,property,py_TypeError,py_iter,py_metatype,py_next,py_reversed,py_typeof,range,repr,round,set,setattr,sorted,str,sum,tuple,zip}from"./org.transcrypt.__runtime__.js";import{init_table}from"./pytigon_js.tbl.js";import{Loading,ajax_get,ajax_post,corect_href,get_table_type,super_insert}from"./pytigon_js.tools.js";var __name__="pytigon_js.ajax_region";export var data_type=function(data_or_html){if(data_or_html)if(py_typeof(data_or_html)==
str)if(__in__("$$RETURN_OK",data_or_html))return"$$RETURN_OK";else if(__in__("$$RETURN_NEW_ROW_OK",data_or_html))return"$$RETURN_NEW_ROW_OK";else if(__in__("$$RETURN_UPDATE_ROW_OK",data_or_html))return"$$RETURN_UPDATE_ROW_OK";else if(__in__("$$RETURN_REFRESH_PARENT",data_or_html))return"$$RETURN_REFRESH_PARENT";else if(__in__("$$RETURN_REFRESH",data_or_html))return"$$RETURN_REFRESH";else if(__in__("$$RETURN_CANCEL",data_or_html))return"$$RETURN_CANCEL";else if(__in__("$$RETURN_RELOAD",data_or_html))return"$$RETURN_RELOAD";
else{if(__in__("$$RETURN_ERROR",data_or_html))return"$$RETURN_ERROR"}else{var meta_list=data_or_html.querySelectorAll("meta");for(var pos of meta_list)if(pos.hasAttribute("name"))if(pos.getAttribute("name").upper()=="RETURN")if(pos.hasAttribute("content"))return pos.getAttribute("content").upper()}return"$$RETURN_HTML"};export var MOUNT_INIT_FUN=[];export var register_mount_fun=function(fun){MOUNT_INIT_FUN.append(fun)};window.register_mount_fun=register_mount_fun;export var mount_html=function(dest_elem,
data_or_html,link){if(typeof link=="undefined"||link!=null&&link.hasOwnProperty("__kwargtrans__"))var link=null;if(getattr(dest_elem,"onloadeddata")&&dest_elem.onloadeddata){var evt=document.createEvent("HTMLEvents");evt.initEvent("loadeddata",false,true);evt.data=data_or_html;evt.data_source=link;dest_elem.dispatchEvent(evt);return}if(data_or_html!=null){var _on_remove=function(index,value){value.on_remove()};jQuery.each(jQuery(dest_elem).find(".call_on_remove"),_on_remove);if(py_typeof(data_or_html)==
str)dest_elem.innerHTML=data_or_html;else{dest_elem.innerHTML="";dest_elem.appendChild(data_or_html)}}if(MOUNT_INIT_FUN)for(var fun of MOUNT_INIT_FUN)fun(dest_elem)};window.mount_html=mount_html;export var datetime_init=function(dest_elem){var format=dict({"singleDatePicker":true,"showDropdowns":true,"buttonClasses":"btn","applyClass":"btn-success align-top","cancelClass":"btn-danger btn-sm align-top","timePicker24Hour":true,"autoApply":true,"locale":dict({"format":"YYYY-MM-DD","separator":"-","applyLabel":"&nbsp; OK &nbsp;",
"cancelLabel":"<i class='fa fa-close'></i>"})});var d=jQuery(dest_elem).find("div.form-group .datefield input");d.daterangepicker(format);format["locale"]["format"]="YYYY-MM-DD HH:mm";format["timePicker"]=true;format["timePickerIncrement"]=30;var d=jQuery(dest_elem).find("div.form-group .datetimefield input");d.daterangepicker(format)};register_mount_fun(datetime_init);export var selectpicker_init=function(dest_elem){jQuery(dest_elem).find(".selectpicker").selectpicker()};register_mount_fun(selectpicker_init);
export var moveelement_init=function(dest_elem){var objs=dest_elem.querySelectorAll(".move-element");if(objs)for(var obj of objs)if(obj.hasAttribute("data-position")){obj.classList.remove("move-element");var data_position=obj.getAttribute("data-position");var parent=obj.parentElement;var elem2=super_insert(dest_elem,obj.getAttribute("data-position"),obj);if(data_position.endswith(":class"))var _on_remove=function(){for(var c of obj.classList)elem2.classList.remove(c)};else var _on_remove=function(){obj.remove()};
parent.on_remove=_on_remove;parent.classList.add("call_on_remove")}};register_mount_fun(moveelement_init);export var label_floating_init=function(dest_elem){var _on_blur=function(e){if(e["type"]=="focus"||this.value.length>0)var test=true;else var test=false;jQuery(this).parents(".form-group").toggleClass("focused",test)};jQuery(dest_elem).find(".label-floating .form-control").on("focus blur",_on_blur).trigger("blur")};register_mount_fun(label_floating_init);export var select2_init=function(dest_elem){jQuery(dest_elem).find(".django-select2:not(.select2-full-width)").djangoSelect2(dict({"width":"calc(100% - 48px)",
"minimumInputLength":1}));jQuery(dest_elem).find(".django-select2.select2-full-width").djangoSelect2(dict({"width":"calc(100%)","minimumInputLength":1}));var set_select2_value=function(sel2,id,text){sel2.append(jQuery("<option>",dict({"value":id,"text":text})));sel2.val(id.toString());sel2.trigger("change")};var controls=dest_elem.querySelectorAll(".django-select2");if(controls)for(var control of controls){var _onloadeddata=function(event){if(hasattr(event,"data_source")){var src_elem=event.data_source;
if(src_elem){var id=src_elem.getAttribute("data-id");var text=src_elem.getAttribute("data-text");set_select2_value(jQuery(control),id,text)}}};control.onloadeddata=_onloadeddata;control.classList.add("ajax-frame");control.setAttribute("data-region","get_row")}var init_select2_ctrl=function(){var sel2=jQuery(this);var src=sel2.closest(".input-group");if(src.length==1)if(src[0].hasAttribute("item_id")){var id=src.attr("item_id");if(id){var text=src.attr("item_str");set_select2_value(sel2,id,text)}}};
jQuery(dest_elem).find(".django-select2").each(init_select2_ctrl)};register_mount_fun(select2_init);export var datatable_init=function(dest_elem){var table_type=get_table_type(jQuery(dest_elem));var tbl=jQuery(dest_elem).find(".tabsort");if(tbl.length>0)init_table(tbl,table_type);jQuery(dest_elem).find(".tree").treegrid()};register_mount_fun(datatable_init);register_mount_fun(process_resize);export var get_ajax_region=function(element,region_name){if(typeof region_name=="undefined"||region_name!=
null&&region_name.hasOwnProperty("__kwargtrans__"))var region_name=null;if(element.classList.contains("ajax-region")&&(!region_name||element.getAttribute("data-region")==region_name))return element;else if(region_name){var ret=element.closest(".ajax-region");while(ret){if(ret.getAttribute("data-region")==region_name)return ret;var ret=ret.parentElement;if(ret)var ret=ret.closest(".ajax-region")}if(region_name)return get_ajax_region(element,null);else return null}else return element.closest(".ajax-region")};
window.get_ajax_region=get_ajax_region;export var get_ajax_link=function(element,region_name){if(typeof region_name=="undefined"||region_name!=null&&region_name.hasOwnProperty("__kwargtrans__"))var region_name=null;if(element.classList.contains("ajax-link")&&(!region_name||element.getAttribute("data-region")==region_name))return element;var region=get_ajax_region(element,region_name);if(region)if(region.classList.contains("ajax-link"))return region;else if(region_name){var link=region.querySelector(".ajax-link[data-region='"+
region_name+"']");if(link)return link}else return region.querySelector(".ajax-link");if(region_name)return get_ajax_link(element,null);else return null};window.get_ajax_link=get_ajax_link;export var get_ajax_frame=function(element,region_name){if(typeof region_name=="undefined"||region_name!=null&&region_name.hasOwnProperty("__kwargtrans__"))var region_name=null;var region=get_ajax_region(element,region_name);if(region)if(region.classList.contains("ajax-frame")&&(!region_name||region.getAttribute("data-region")==
region_name))return region;else if(region_name){var frame=region.querySelector(".ajax-frame[data-region='"+region_name+"']");if(frame)return frame}else return region.querySelector(".ajax-frame");if(region_name)return get_ajax_frame(element,null);else return null};window.get_ajax_frame=get_ajax_frame;export var refresh_ajax_frame=function(element,region_name,data_element,callback,callback_on_error){if(typeof region_name=="undefined"||region_name!=null&&region_name.hasOwnProperty("__kwargtrans__"))var region_name=
null;if(typeof data_element=="undefined"||data_element!=null&&data_element.hasOwnProperty("__kwargtrans__"))var data_element=null;if(typeof callback=="undefined"||callback!=null&&callback.hasOwnProperty("__kwargtrans__"))var callback=null;if(typeof callback_on_error=="undefined"||callback_on_error!=null&&callback_on_error.hasOwnProperty("__kwargtrans__"))var callback_on_error=null;var region=get_ajax_region(element,region_name);var frame=get_ajax_frame(element,region_name);if(!frame)return;var link=
get_ajax_link(element,region_name);var loading=Loading(element);var _callback=function(data){loading.stop();loading.remove();var dt=data_type(data);if(dt!="$$RETURN_ERROR"&&getattr(frame,"onloadeddata")&&frame.onloadeddata)mount_html(frame,data,link);else if(__in__(dt,tuple(["$$RETURN_OK","$$RETURN_REFRESH"])))return refresh_ajax_frame(element,region_name,null,callback,callback_on_error);else if(__in__(dt,tuple(["$$RETURN_NEW_ROW_OK","$$RETURN_UPDATE_ROW_OK","$$RETURN_REFRESH_PARENT"])))return refresh_ajax_frame(region.parentElement,
region_name,null,callback,callback_on_error);else if(dt=="$$RETURN_RELOAD")if(region_name=="error")mount_html(frame,data,link);else return refresh_ajax_frame(element,"error",data,callback,callback_on_error);else if(dt=="$$RETURN_CANCEL");else if(dt=="$$RETURN_ERROR")if(py_typeof(data)==str)window.open().document.write(data);else window.open().document.write(data.innerHTML);else mount_html(frame,data,link);if(__in__(dt,tuple(["$$RETURN_ERROR","$$RETURN_RELOAD"]))){if(callback_on_error)callback_on_error()}else if(callback)callback()};
if(data_element){_callback(data_element);return}var url=null;var post=false;if(link.hasAttribute("href"))var url=link.getAttribute("href");else if(link.hasAttribute("action")){var url=link.getAttribute("action");var post=true}else if(link.hasAttribute("src"))var url=link.getAttribute("src");if(url){if(link.hasAttribute("data-region")&&link.getAttribute("data-region")=="table")var url=corect_href(url,true);else var url=corect_href(url);loading.create();loading.start();if(post)if(link.tagName.lower()==
"form")ajax_submit(jQuery(link),_callback);else{var data=jQuery(link).serialize();ajax_post(url,data,_callback)}else ajax_get(url,_callback)}else _callback(null)};window.refresh_ajax_frame=refresh_ajax_frame;export var ajax_load=function(element,url,complete){var _onload=function(responseText){mount_html(element,responseText,null);complete(responseText)};ajax_get(url,_onload)};window.ajax_load=ajax_load;

//# sourceMappingURL=pytigon_js.ajax_region.map